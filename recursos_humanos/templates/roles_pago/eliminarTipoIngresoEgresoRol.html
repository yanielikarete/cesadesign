{% extends "login/base_nuevo.html" %}
{% load staticfiles %}

{# Load the tag library #}
{% load bootstrap3 %}

{# Load CSS and JavaScript #}
{% bootstrap_javascript %}

{# Display django.contrib.messages as Bootstrap alerts #}
{% bootstrap_messages %}

{% block css %}
{{ block.super }}
    <!-- ================== BEGIN PAGE LEVEL STYLE ================== -->
    # -*- coding: UTF8 -*-
    <link href="{% static 'color_admin/assets/plugins/bootstrap-wizard/css/bwizard.min.css' %}" rel="stylesheet" />
        <link href="{% static 'color_admin/assets/plugins/bootstrap-datepicker/css/datepicker.css'%}" rel="stylesheet" />
  <link href="{% static 'color_admin/assets/plugins/bootstrap-datepicker/css/datepicker3.css'%}" rel="stylesheet" />
    <!-- ================== END PAGE LEVEL STYLE ================== -->
{% endblock %}

{% block section_title %}Eliminacion Global de los Tipos de Ingreso Egreso - Rol de Pago Mensual {% endblock %}
{% block section_subtitle %}Por favor diligencie el siguiente formulario{% endblock %}
{% block content %}

            <!-- begin row -->
           <style>
       .panel-border{border: 1px solid #ddd !important}
       .form-ajust .form-group{margin-bottom: 0px !important}
      input[type="text"],select,input[type="number"]
      {

    border: 1px solid #ccd0d4;
    border-radius: 3px;
    box-shadow: none;
    font-size: 12px;
    display: block;
    width: 100%;
    height: 34px;
    padding: 6px 12px;
    line-height: 1.42857143;
    color: #555;
    background-color: #fff;
    background-image: none;
       }

 .table2 {
    width: 100%;
    max-width: 100%;
    margin-bottom: 20px;
      display:table}

.table2>tbody>tr>td, .table2>tbody>tr>th, .table2>tfoot>tr>td, .table2>tfoot>tr>th {
    border-color: #e2e7eb;
    padding: 1px 0px!important;
}

 .table2>thead>tr>td, .table2>thead>tr>th {
    border-color: #e2e7eb;
    padding: 1px !important;
}

.table > tbody > tr > td, .table > tbody > tr > th, .table > tfoot > tr > td, .table > tfoot > tr > th, .table > thead > tr > td, .table > thead > tr > th {
    border-color: #e2e7eb;
    padding: 1px !important;
}
    </style>
<form class="form-horizontal" method="post" data-parsley-validate="true" name="form-wizard" enctype="multipart/form-data"> {% csrf_token %}
			    	<!-- INICIO PANEL DE BUSQUEDA -->
					<div class="panel-group" id="accordion">
						<div class="panel panel-inverse overflow-hidden">
							<div class="panel-heading">
								<h3 class="panel-title">
									<a class="accordion-toggle accordion-toggle-styled" data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true">
									    <i class="fa fa-plus-circle pull-right"></i>
										Búsqueda
									</a>
								</h3>
							</div>
							<div id="collapseOne" class="panel-collapse collapse in" aria-expanded="true">
								<div class="panel-body">

				                        <div class="form-group">
				                            <label class="col-md-2 col-sm-2 control-label"> Año: </label>
				                            <div class="col-md-4 col-sm-4">
												

											<select class="select-input form-control input-sm" id="id_anio" name="anio">
												{% for a in anio %}
												<option value="{{a.nombre}}">{{a.nombre}}</option>
												{% endfor %}
												</select>

											</div>

				                            <label class="col-md-2 col-sm-2 control-label"> Mes: </label>
				                            <div class="col-md-4 col-sm-4">
												<select class="select-input form-control input-sm" id="id_mes" name="mes">
												<option value="1">Enero</option>
												<option value="2">Febrero</option>
												<option value="3">Marzo</option>
												<option value="4" selected="selected">Abril</option>
												<option value="5">Mayo</option>
												<option value="6">Junio</option>
												<option value="7">Julio</option>
												<option value="8">Agosto</option>
												<option value="9">Septiembre</option>
												<option value="10">Octubre</option>
												<option value="11">Noviembre</option>
												<option value="12">Diciembre</option>
												</select></div>

<br>
				                                <label class="col-md-2 col-sm-2 control-label"> Tipo de Ingreso /Egreso: </label>
				                                <div class="col-md-6 col-sm-6">
															<select class="form-control input-sm" id="id_tipo" name="tipo" >
																<option value="0">Seleccione</option>
												{% for t in tipos %}
												<option value="{{t.id}}">{{t.nombre}}</option>
												{% endfor %}
												</select></div>

				                        </div>

			                        <hr>
											
			                        <div class="pull-right">

			                                <button type="button" class="btn btn-primary mb5" onclick="javascript:eliminarTipo();">
			                                    <i class="ico-files"></i> Eliminar
			                                </button>
													  

			                        </div>
											

			                	</div>
							</div>
						</div>



					</div>



	

				




	<div class="panel-group" id="accordion">
						<div class="panel panel-inverse overflow-hidden">
							<div class="panel-heading">
								<h3 class="panel-title">
									<a class="accordion-toggle accordion-toggle-styled" data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true">
									    <i class="fa fa-plus-circle pull-right"></i>
										Resultados
									</a>
								</h3>
							</div>
							<div id="collapseOne" class="panel-collapse collapse in" aria-expanded="true">
								<div class="panel-body">

				                        <div class="form-group" id="resultados">
				                           	</div>

				                            

			                        <hr>
											
			                      
											

			                	</div>
							</div>
						</div>



					</div>



	

				
</form>
				    <!-- fin del form -->
	{% endblock %}

{% block javascript %}
{{ block.super }}
<script src="{% static 'color_admin/assets/plugins/parsley/dist/parsley.js' %}"></script>
<script src="{% static 'color_admin/assets/plugins/bootstrap-wizard/js/bwizard.js' %}"></script>
<script src="https://swisnl.github.io/jQuery-contextMenu/dist/jquery.contextMenu.js" type="text/javascript"></script>

<script src="{% static 'color_admin/assets/js/apps.min.js' %}"></script>	<!-- ================== END BASE JS ================== -->


	<script>
		var mas = false;
		$(document).ready(function() {
			//App.init();
			//Dashboard.init();
			$("#datepicker-default").datepicker({todayHighlight:!0});
			$("#btn_guardar_ingresos").click(function(){


			});
		});


		function eliminarTipo(){
            var mes = $('#id_mes').val();
            var tipo = $('#id_tipo').val();
            var anio = $('#id_anio').val();
            var parametros = {
                'mes': mes,
                'anio': anio,
                'tipo':tipo,
                'csrfmiddlewaretoken': '{{ csrf_token }}'

            }
				if (tipo=='0') {
					alert("Debe Seleccionar un tipo");
                    //code
                }else{
						   $.ajax({
                    url: "/recursos_humanos/eliminarTipoRol/", // the endpoint
                    type: "POST", // http method
                    data: parametros,
                    success: function (data) {
                        $('#div-consultando').remove();

                        $(parent).remove();
                        $("#resultados").html(data);
                    },
                    error: function () {

                    },
                });
						
					 }
				//alert('entro4');
    }
function add_div() {
            var div_externo = $('<div id="div-consultando" style="width: 100%; height: 100%; background-color: #191a1b; position: fixed; top: 0; right: 0; bottom: 0; left: 0; z-index: 1050; opacity: 0.8">');
            var div_interno = $('<div class="progress progress-striped active" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, 50%); width: 50%">');
            var progress = $('<div class="progress-bar progress-bar-inverse" style="width: 100%">Eliminando...</div>');

            div_interno.append(progress);
            div_externo.append(div_interno);

            div_externo.appendTo($('body'));

        }


		function cargarPlantillas(){
            var mes = $('#id_mes').val();
            var quincena = $('#id_quincena').val();
            var anio = $('#id_anio').val();
            var parametros = {
                'mes': mes,
                'anio': anio,
                'quincena':quincena,
                'csrfmiddlewaretoken': '{{ csrf_token }}'

            }
          $.ajax({
                url: "/recursos_humanos/obtenerRolPlantillas/", // the endpoint
                type : "POST", // http method
                data: parametros,
                success:function(data){

                  $("#plantilla form").remove();

                  $("#plantilla").append(data);
                },
                error: function(){

                },
              });
    }


    	function agregarPlantillas(){
    		 var selected = '';
		        $('#formid input[type=checkbox]').each(function(){
		            if (this.checked) {
		                selected += $(this).val()+', ';
		            }
		        });
				  selected +='0';
		       var mes = $('#id_mes').val();
            var quincena = $('#id_quincena').val();
            var anio = $('#id_anio').val();


          if (selected != '')
            alert('Has seleccionado: '+selected);
        else
            alert('Debes seleccionar al menos una opción.');
         var parametros = {
                'selected': selected,
                'mes': mes,
                'anio': anio,
                'quincena':quincena,
                'csrfmiddlewaretoken': '{{ csrf_token }}'

            }

         $.ajax({
                url: "/recursos_humanos/agregarPlantillas/", // the endpoint
                type : "POST", // http method
                data: parametros,
                success:function(data){

                  alert(data);
                  seleccionarEmpleados();
                },
                error: function(){

                },
              });

    }

   function ingresos_ad(prefix){
            $("#id_popup_ingresos").html("<b>Ingresos Adicionales</b>");
            var id_txt_otros_ingresos = $('#id_empleado'+prefix).val();
            var mes = $('#id_mes').val();
            var quincena = $('#id_quincena').val();
            var anio = $('#id_anio').val();
            var tipo_contrato_persona = $('#tipo_contrato_persona').val();
            var fila=prefix



            var parametros = {
                'mes': mes,
                'anio': anio,
                'quincena':quincena,
                'tipo_contrato_persona': tipo_contrato_persona,
                'id_txt_otros_ingresos':id_txt_otros_ingresos,
                'fila':fila,
                'csrfmiddlewaretoken': '{{ csrf_token }}'

            }

            $.ajax({
                    url: "/recursos_humanos/mostrar_otros_ingresos/",
                    type: "POST",
                    async: true,
                    data: parametros,
                    success: function(data){
                        $('#contenido_dlgIngreso').html(data);

                        mes = $('#id_mes').val();
                        quincena = $('#id_quincena').val();
                        anio = $('#id_anio').val();

                            $('#mes_id').val(mes);
                            $('#quincena_id').val(quincena);
                            $('#anio_id').val(anio);
                            $('#tipo_ingreso_id').val('');
                            var meses = $('input[id$="-mes_ingreso"]');
                            for(var i=0;i<meses.length;i++) {
                                meses[i].value = mes;
                            }
                            var anios = $('input[id$="-anio_ingreso"]');
                            for(var i=0;i<anios.length;i++) {
                                anios[i].value = anio;
                            }
                            var quincenas = $('input[id$="-quincena_ingreso"]');
                            for(var i=0;i<quincenas.length;i++) {
                                if(quincena == '1Q'){
                                    quincenas[i].value = "P";
                                }else{
                                    quincenas[i].value = "S";
                                }
                            }

                    },
                    complete: function(){
                       $("#btn_guardar_ingresos").show();
                    }
                });
            $('#dlgIngreso').modal();
        }

        function egresos_ad(prefix){
            $("#id_popup_egresos").html("<b>Egresos Adicionales</b>");
            var id_txt_otros_egresos = $('#id_empleado'+prefix).val();
            var mes = $('#id_mes').val();
            var quincena = $('#id_quincena').val();
            var anio = $('#id_anio').val();
            var tipo_contrato_persona = $('#tipo_contrato_persona').val();
            var fila=prefix;



            var parametros = {
                'mes': mes,
                'anio': anio,
                'quincena':quincena,
                'tipo_contrato_persona': tipo_contrato_persona,
                'id_txt_otros_egresos':id_txt_otros_egresos,
                'fila':fila,
                'csrfmiddlewaretoken': '{{ csrf_token }}'

            }

            $.ajax({
                    url: "/recursos_humanos/mostrar_otros_egresos/",
                    type: "POST",
                    async: true,
                    data: parametros,
                    success: function(data){
                        $('#contenido_dlgEgreso').html(data);

                        mes = $('#id_mes').val();
                        quincena = $('#id_quincena').val();
                        anio = $('#id_anio').val();

                            $('#mes_id').val(mes);
                            $('#quincena_id').val(quincena);
                            $('#anio_id').val(anio);
                            $('#tipo_ingreso_id').val('');
                            var meses = $('input[id$="-mes_ingreso"]');
                            for(var i=0;i<meses.length;i++) {
                                meses[i].value = mes;
                            }
                            var anios = $('input[id$="-anio_ingreso"]');
                            for(var i=0;i<anios.length;i++) {
                                anios[i].value = anio;
                            }
                            var quincenas = $('input[id$="-quincena_ingreso"]');
                            for(var i=0;i<quincenas.length;i++) {
                                if(quincena == '1Q'){
                                    quincenas[i].value = "P";
                                }else{
                                    quincenas[i].value = "S";
                                }
                            }

                    },
                    complete: function(){
                       $("#btn_guardar_egresos").show();
                    }
                });
            $('#dlgEgreso').modal();
        }


function egresos(prefix){
            $("#id_popup_egresos").html("<b>Egresos</b>");
            var id_txt_otros_egresos = $('#id_empleado'+prefix).val();
            var mes = $('#id_mes').val();
            var quincena = $('#id_quincena').val();
            var anio = $('#id_anio').val();
            var tipo_contrato_persona = $('#tipo_contrato_persona').val();
            var fila=prefix;




            var parametros = {
                'mes': mes,
                'anio': anio,
                'quincena':quincena,
                'id_txt_otros_egresos':id_txt_otros_egresos,
                'fila':fila,
                'csrfmiddlewaretoken': '{{ csrf_token }}'

            }

            $.ajax({
                    url: "/recursos_humanos/mostrar_egresos/",
                    type: "POST",
                    async: true,
                    data: parametros,
                    success: function(data){
                        $('#contenido_dlgEgreso').html(data);

                        mes = $('#id_mes').val();
                        quincena = $('#id_quincena').val();
                        anio = $('#id_anio').val();

                            $('#mes_id').val(mes);
                            $('#quincena_id').val(quincena);
                            $('#anio_id').val(anio);
                            $('#tipo_ingreso_id').val('');
                            var meses = $('input[id$="-mes_ingreso"]');
                            for(var i=0;i<meses.length;i++) {
                                meses[i].value = mes;
                            }
                            var anios = $('input[id$="-anio_ingreso"]');
                            for(var i=0;i<anios.length;i++) {
                                anios[i].value = anio;
                            }
                            var quincenas = $('input[id$="-quincena_ingreso"]');
                            for(var i=0;i<quincenas.length;i++) {
                                if(quincena == '1Q'){
                                    quincenas[i].value = "P";
                                }else{
                                    quincenas[i].value = "S";
                                }
                            }

                    },
                    complete: function(){
                      // $("#btn_guardar_egresos").show();
                    }
                });
            $('#dlgEgreso').modal();
        }


function ingresos(prefix){
            $("#id_popup_egresos").html("<b>Ingresos</b>");
            var id_txt_otros_ingresos = $('#id_empleado'+prefix).val();
            var mes = $('#id_mes').val();
            var quincena = $('#id_quincena').val();
            var anio = $('#id_anio').val();

            var fila=prefix



            var parametros = {
                'mes': mes,
                'anio': anio,
                'quincena':quincena,
                'id_txt_otros_ingresos':id_txt_otros_ingresos,
                'fila':fila,
                'csrfmiddlewaretoken': '{{ csrf_token }}'

            }

            $.ajax({
                    url: "/recursos_humanos/mostrar_ingresos/",
                    type: "POST",
                    async: true,
                    data: parametros,
                    success: function(data){
                        $('#contenido_dlgIngreso').html(data);

                        mes = $('#id_mes').val();
                        quincena = $('#id_quincena').val();
                        anio = $('#id_anio').val();

                            $('#mes_id').val(mes);
                            $('#quincena_id').val(quincena);
                            $('#anio_id').val(anio);
                            $('#tipo_ingreso_id').val('');
                            var meses = $('input[id$="-mes_ingreso"]');
                            for(var i=0;i<meses.length;i++) {
                                meses[i].value = mes;
                            }
                            var anios = $('input[id$="-anio_ingreso"]');
                            for(var i=0;i<anios.length;i++) {
                                anios[i].value = anio;
                            }
                            var quincenas = $('input[id$="-quincena_ingreso"]');
                            for(var i=0;i<quincenas.length;i++) {
                                if(quincena == '1Q'){
                                    quincenas[i].value = "P";
                                }else{
                                    quincenas[i].value = "S";
                                }
                            }

                    },
                    complete: function(){
                      // $("#btn_guardar_egresos").show();
                    }
                });
            $('#dlgIngreso').modal();
        }





  function dias_ad(prefix){
            $("#id_popup_dias").html("<b>Dias No Laborados</b>");
            var id_txt_otros_dias = $('#id_empleado'+prefix).val();
            var mes = $('#id_mes').val();
            var quincena = $('#id_quincena').val();
            var anio = $('#id_anio').val();
            var fila=prefix



            var parametros = {
                'mes': mes,
                'anio': anio,
                'quincena':quincena,
                'id_txt_otros_dias':id_txt_otros_dias,
                'fila':fila,
                'csrfmiddlewaretoken': '{{ csrf_token }}'

            }

            $.ajax({
                    url: "/recursos_humanos/mostrar_dias/",
                    type: "POST",
                    async: true,
                    data: parametros,
                    success: function(data){
                        $('#contenido_dlgDias').html(data);

                        mes = $('#id_mes').val();
                        quincena = $('#id_quincena').val();
                        anio = $('#id_anio').val();

                            $('#mes_id').val(mes);
                            $('#quincena_id').val(quincena);
                            $('#anio_id').val(anio);
                            $('#tipo_ingreso_id').val('');
                            var meses = $('input[id$="-mes_ingreso"]');
                            for(var i=0;i<meses.length;i++) {
                                meses[i].value = mes;
                            }
                            var anios = $('input[id$="-anio_ingreso"]');
                            for(var i=0;i<anios.length;i++) {
                                anios[i].value = anio;
                            }
                            var quincenas = $('input[id$="-quincena_ingreso"]');
                            for(var i=0;i<quincenas.length;i++) {
                                if(quincena == '1Q'){
                                    quincenas[i].value = "P";
                                }else{
                                    quincenas[i].value = "S";
                                }
                            }

                    },
                    complete: function(){
                       $("#btn_guardar_dias").show();
                    }
                });
            $('#dlgDias').modal();
        }

function actualizarTotal(){
    var num_recetas=$('#columnas_receta_roles').val();
      var total=0;
      var cantidad=0;

      var ingresos=0;
      var otros_ingresos=0;
      var egresos=0;
      var otros_egresos=0;
      var total_ingresos=0;
      var total_otros_ingresos=0;
      var total_egresos=0;
      var total_otros_egresos=0;
      var total_recibir=0;
      var total_dias=0;
      var i;
      alert('Guardando...');
      for (i = 1; i <= num_recetas; i++) {

        if ($('#id_pago_'+i+'_total').length){
            ingresos=$('#id_pago_'+i+'_total').val();
            otros_ingresos=$('#id_pago_'+i+'_otros_ingresos').val();
            egresos=$('#id_pago_'+i+'_total_egresos').val();
            otros_egresos=$('#id_pago_'+i+'_otros_egresos').val();

            //alert(total_dias);
            if ($('#id_pago_'+i+'_dias_valor').length){
 total_dias=$('#id_pago_'+i+'_dias_valor').val();
            }else{
total_dias=0;
            }

            if ($('#id_pago_'+i+'_valor_vacaciones').length){
 						total_dias=total_dias+$('#id_pago_'+i+'_valor_vacaciones').val();
            }else{
            }

            total=parseFloat(ingresos)+parseFloat(otros_ingresos)-parseFloat(egresos)-parseFloat(otros_egresos);
           //alert(total);
            $('#id_pago_'+i+'_valor_a_recibir').val((total).toFixed(2));
            total_recibir+=total;
          }


      }


}

	</script>
{% endblock %}
