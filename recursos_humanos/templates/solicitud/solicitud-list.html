{% extends "login/base-list.html" %}
{% load extra_filters %}

{% load staticfiles %}
{# Load the tag library #}
{% load bootstrap3 %}
{% block css %}
{{ block.super }}
<!-- ================== BEGIN PAGE LEVEL STYLE TABLE================== -->
<link href="{% static 'color_admin/assets/plugins/bootstrap-wizard/css/bwizard.min.css' %}" rel="stylesheet" />
<link href="{% static 'color_admin/assets/plugins/bootstrap-datepicker/css/datepicker.css'%}" rel="stylesheet"/>
<link href="{% static 'color_admin/assets/plugins/bootstrap-datepicker/css/datepicker3.css'%}" rel="stylesheet"/>
<link rel="stylesheet" href="{% static 'color_admin/assets/plugins/bootstrap-timepicker/css/bootstrap-timepicker.min.css'%}" />
<link rel="stylesheet" href="{% static 'color_admin/assets/plugins/bootstrap-daterangepicker/daterangepicker.css'%}" />
<!-- ================== END PAGE LEVEL STYLE ================== -->
{% endblock %}

{% block section_title %}Solicitudes & Permisos{% endblock %}
{% block section_subtitle %}{% endblock %}

{% block content %}

<!-- begin col-12 -->
<div class="col-md-12">
    <div class="panel-group" id="accordion">
        <div class="panel panel-inverse overflow-hidden">
            <div class="panel-heading">
                <h3 class="panel-title">
                    <a aria-expanded="false" class="accordion-toggle accordion-toggle-styled collapsed"
                       data-toggle="collapse"
                       data-parent="#accordion" href="#collapseOne">
                        <i class="fa fa-plus-circle pull-right"></i>
                        FORMULARIO - INGRESO DE SOLICITUD
                    </a>
                </h3>
            </div>
            <div style="" aria-expanded="false" id="collapseOne" class="panel-collapse collapse">
                <div class="panel-body">
                    <form id="solicitud-create-form" data-parsley-validate="true" name="form-wizard"  method="POST" action="/solicitud-create/">
                        {% csrf_token %}
                        <div class="row">
                            <div class="col-md-6">
                                <label>Tipo de Solicitud</label>
                                {% bootstrap_field new.tipo_solicitud show_label=False required=required %}
                            </div>
                            <div class="col-md-6">
                                <label>Fecha Solicitud</label>
                                {% bootstrap_field new.fecha_solicitud show_label=False  required=required %}
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <label>Empleado</label>
                                {% bootstrap_field new.empleados_empleado show_label=False required=True %}

                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-md-12 text-center">
                                <h3 id="create-title"></h3>
                            </div>
                        </div>
                        <div class="row permiso">

                            <div class="col-md-12">
                                <label class="radio-inline col-md-offset-1 col-md-2"><input type="radio" name="optradio" value="1">PERMISO POR
                                    DÍAS</label>
                                <label class="radio-inline col-md-2"><input type="radio" name="optradio" value="2">PERMISO POR
                                    HORAS</label>
                                <label class="radio-inline col-md-2"><input type="radio" name="optradio" value="3">LICENCIA POR
                                    DÍAS</label>
                                <label class="radio-inline col-md-2"><input type="radio" name="optradio" value="4">DESCANSO
                                    IESS/DÍAS</label>
                                <label class="radio-inline col-md-2"><input type="radio" name="optradio" value="5">CITAS
                                    IESS/HORAS</label>
                            </div>
                            <hr>
                        </div>
                        <div class="row permiso vacaciones">
                            <div class="col-md-12">
                                    <label>Fechas</label>
									<div class="form-group" >
									    <div class="input-group active">
										    <input  id="fecha_desde_hasta"  name="default-daterange" class="form-control" value="" placeholder="Seleccione rango de fechas" type="text"  readonly>
										    <span class="input-group-btn">
												<button class="btn btn-default" type="button"><i class="fa fa-calendar"></i></button>
											</span>
										</div>
									</div>
                            </div>

                        </div>
                        <div class="row permiso">

                            <div class="col-md-12">
                                <label>Total días ausencia</label>
                                <div class="form-group">
                                        <input class="form-control" id="id_total_dias_ausencia" name="total_dias_ausencia" type="text" readonly>
                                </div>
                            </div>
                        </div>

                        <div class="row permiso autorizaciones">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>Hora desde</label>
                                    <div class="input-group bootstrap-timepicker timepicker">
                                        <input class="form-control" type="text"  id="id_hora_desde" name="hora_desde" readonly="readonly" required>
                                        <span class="input-group-addon">
                                        <span class="glyphicon glyphicon-time"></span>
                                    </span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>Hora hasta</label>
                                    <div class="input-group bootstrap-timepicker timepicker">
                                        <input class="form-control" type="text" id="id_hora_hasta" name="hora_hasta" readonly="readonly" required>
                                        <span class="input-group-addon">
                                        <span class="glyphicon glyphicon-time"></span>
                                    </span>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="row permiso">
                            <div class="col-md-12">
                                 <label>Total horas de ausencia</label>
                                <div class="form-group">
                                        <input class="form-control" id="id_total_horas_ausencia"  name="total_horas_ausencia" type="text" readonly>
                                </div>
                            </div>
                        </div>
                        <div class="row permiso">
                            <hr>
                            <div class="col-md-12">
                                <label class="radio-inline col-md-offset-2 col-md-2"><input type="radio" name="motivoradio" value="1">MOTIVO
                                    TRABAJO</label>
                                <label class="radio-inline col-md-2"><input type="radio" name="motivoradio" value="2">MOTIVO
                                    PERSONAL</label>
                                <label class="radio-inline col-md-2"><input type="radio" name="motivoradio" value="3">MOTIVO
                                    CALAMIDAD</label>
                                <label class="radio-inline col-md-3"><input type="radio" name="motivoradio" value="4">MOTIVO
                                    ENFERMEDAD</label>

                            </div>

                        </div>
                        <div class="row permiso">

                            <div class="col-md-12">
                                <label>Cargo a vacaciones</label>
                                {% bootstrap_field new.cargo_vacaciones show_label=False %}
                            </div>


                        </div>
                        <div class="row vacaciones">

                            <div class="col-md-12 text-center">
                                <label class="radio-inline"><input type="radio" name="vacacionesradio" value="1">VACACIONES</label>
                                <label class="radio-inline"><input type="radio" name="vacacionesradio" value="2">PERMISOS</label>

                            </div>
                            <hr>
                        </div>
                        <div class="row vacaciones">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>Total día gozados</label>
                                    <input type="text" readonly id="total_dias_gozados" class="form-control"/>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <label>Total días pendientes</label>
                                {% bootstrap_field new.total_dias_pendientes show_label=False %}
                            </div>
                            <div class="col-md-4">
                                <label>Periodo días pendientes</label>
                                {% bootstrap_field new.periodo_dias_pendiente show_label=False %}
                            </div>


                        </div>
                        <div class="row autorizaciones" >
                             <div class="col-md-12">
                                <label>Total horas laboradas</label>
                                {% bootstrap_field new.total_horas_laboradas show_label=False %}
                            </div>
                        </div>
                        <div class="row">


                            <div class="col-md-12">
                                <label>Observación</label>
                                {% bootstrap_field new.observacion show_label=False %}
                            </div>

                        </div>
                        <div class="text-right">
                            <a href="javascript:;" class="btn btn-md btn-white" data-dismiss="modal">Cancelar</a>
                            <button type="submit" class="btn btn-md btn-success">Aceptar</button>
                        </div>

                    </form>
                </div>
            </div>
        </div>

    </div>
</div>

<div class="col-md-12">
    <!-- begin panel -->
    <div class="panel panel-inverse">
        <div class="panel-heading">
            <div class="panel-heading-btn">
                <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-default" data-click="panel-expand"><i
                        class="fa fa-expand"></i></a>
                <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-warning" data-click="panel-collapse"><i
                        class="fa fa-minus"></i></a>
            </div>
            <h4 class="panel-title">LISTADO DE SOLICITUDES</h4>
        </div>
        <div class="panel-body">
            <div class="table-responsive" id="refresh">
                <table id="data-table" class="table table-striped table-bordered">
                    <thead>
                    <tr>

                        <th>Tipo Solicitud</th>
                        <th>Empleado</th>
                        <th>Fecha de Solicitud</th>
                        <th>Estado</th>
                        <th></th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for l in list %}

                    <tr>

                        <td>{{ l.tipo_solicitud }}</td>
                        <td>{{ l.empleados_empleado }}</td>
                        <td>{{ l.fecha_solicitud | date:"d M Y" }}</td>
                        <td>
                            {% if not l.activo == 1 and not l.activo == 0 %}
                            PENDIENTE
                            {% elif l.activo == 0 %}
                            NEGADA
                            {% elif l.activo == 1 %}
                            APROBADA
                            {% endif %}
                        </td>
                        <td>
                            {% if not l.activo == 1 and not l.activo == 0 %}
                            <a data-toggle="modal" data-id="{{l.id}}" data-empleado="{{ l.empleados_empleado }}"
                               data-tipo="{{ l.tipo_solicitud }}" class="btn btn-default btn-xs update-solicitud">
                                <i class="fa fa-edit" title="Editar"></i>
                            </a>
                            {% endif %}
                            <a data-toggle="modal" data-id="{{l.id}}" data-empleado="{{ l.empleados_empleado }}"
                               data-tipo="{{ l.tipo_solicitud }}" data-estado="{{ l.activo }}"
                               class="btn btn-info btn-xs detail-solicitud">
                                <i class="fa fa-search" title="Ver"></i>
                            </a>
                        </td>

                    </tr>

                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>


    </div>
</div>

<!-- end panel -->
<div style="display: none;" class="modal fade" id="update-solicitud">
    <form id="update-solicitud-form" method="POST" action="/update-solicitud/">
        {% csrf_token %}
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title">Aprueba la siguiente Solicitud</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <input type="hidden" id="field-id"/>
                        {% csrf_token %}
                        <div class="col-md-4"><b>Tipo de solicitud:</b></div>
                        <div class="col-md-8"><span id="field-tipo"></span></div>
                        <div class="col-md-4"><b>Empleado:</b></div>
                        <div class="col-md-8"><span id="field-empleado"></span></div>
                        <div class="col-md-4"><b>Seleccione estado:</b></div>
                        <div class="col-md-8 text-center">

                            {% bootstrap_field new.activo show_label=False %}
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="javascript:;" class="btn btn-sm btn-white" data-dismiss="modal">Cancelar</a>
                    <button type="submit" class="btn btn-sm btn-success">Aceptar</button>

                </div>
            </div>
        </div>
    </form>
</div>
<!-- #modal-dialog -->

<div style="display: none;" class="modal fade" id="detail-solicitud">
    <form id="detail-solicitud-form" method="POST" action="/update-solicitud/">
        {% csrf_token %}
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title">Información de la Solicitud</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <input type="hidden" id="detail-id"/>
                        {% csrf_token %}
                        <div class="col-md-4"><b>Tipo de solicitud:</b></div>
                        <div class="col-md-8"><span id="detail-tipo"></span></div>
                        <div class="col-md-4"><b>Empleado:</b></div>
                        <div class="col-md-8"><span id="detail-empleado"></span></div>
                        <div class="col-md-4"><b>Estado:</b></div>
                        <div class="col-md-8"><span id="detail-estado"></span></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="javascript:;" class="btn btn-sm btn-white" data-dismiss="modal">Cancelar</a>
                    <div id="imprimir-id">

                    </div>


                </div>
            </div>
        </div>
    </form>
</div>
<!-- #modal-dialog -->
<!-- end col-12 -->
{% endblock %}

{% block javascript %}
{{ block.super }}


<script src="{% static 'color_admin/assets/js/inbox.demo.min.js' %}"></script>
<script src="{% static 'color_admin/assets/plugins/bootstrap-daterangepicker/moment.js' %}"></script>
<script src="{% static 'color_admin/assets/plugins/bootstrap-timepicker/js/bootstrap-timepicker.min.js' %}"></script>
<script src="{% static 'color_admin/assets/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.js' %}"></script>
<script src="{% static 'color_admin/assets/plugins/bootstrap-daterangepicker/daterangepicker.js' %}"></script>
<script src="{% static 'color_admin/assets/js/tools.js' %}"></script>
<script src="{% static 'color_admin/assets/js/censea.js' %}"></script>
<script src="{% static 'color_admin/assets/plugins/parsley/dist/parsley.js' %}"></script>
<script src="{% static 'color_admin/assets/plugins/bootstrap-wizard/js/bwizard.js' %}"></script>


<!--
 ================== END PAGE LEVEL JS ================== -->
<script type="text/javascript">
    $(document).ready(function () {
        //FormWizardValidation.init();

        $('#solicitud-create-form').trigger("reset");
        $('#id_fecha_solicitud').attr('readonly', 'readonly');
        $('#id_fecha_solicitud').datepicker({todayHighlight: true, autoclose: true, format: 'yyyy-mm-dd'});
        $("#id_fecha_solicitud").datepicker('setDate', new Date());

        $('.update-solicitud').click(function () {
            $('#update-solicitud-form').trigger("reset");
            $('#field-empleado').html($(this).data('empleado'));
            $('#field-tipo').html($(this).data('tipo'));
            $('#field-id').val($(this).data('id'));
            $('#update-solicitud').modal();
        });

        $('.detail-solicitud').click(function () {
            $('#detail-solicitud-form').trigger("reset");
            $('#detail-empleado').html($(this).data('empleado'));
            $('#detail-tipo').html($(this).data('tipo'));
            $('#detail-id').val($(this).data('id'));
            id=$(this).data('id');
            $('#imprimir-id').html('<a href="/recursos_humanos/SolicitudImprimir/'+id+'/" style="color:white;" class="btn btn-sm btn-success">IMPRIMIR</a>');

            var estado = ($(this).data('estado') == 'True') ? 'APROBADA' : ($(this).data('estado') == 'False' ? 'NEGADA' : 'PENDIENTE');
            $('#detail-estado').html(estado);
            $('#detail-solicitud').modal();
        });

    });
</script>
{% if form.errors or form_mode == "update" %}
<script type="text/javascript">
    $(document).ready(function () {
        $(".modal").modal('toggle');
    });
</script>

{% endif %}
{% endblock %}
