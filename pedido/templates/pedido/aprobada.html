{% extends "login/base-list.html" %}
{% load extra_filters %}

{% load staticfiles %}

{% block css %}
{{ block.super }}
{% endblock %}

{% block section_title %}Aprobar Pedidos{% endblock %}
{% block section_subtitle %}
<br />
 <div class="email-btn-row hidden-xs">
                    </div>

                    {% endblock %}

{% block content %}
				<!-- begin col-12 -->
				<div class="col-md-12">
					<!-- begin panel -->
					<div class="panel panel-inverse">
						<div class="panel-heading">
							<div class="panel-heading-btn">
								<a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-default" data-click="panel-expand"><i class="fa fa-expand"></i></a>
								<a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-warning" data-click="panel-collapse"><i class="fa fa-minus"></i></a>
							</div>
							<h4 class="panel-title">Pedidos</h4>
						</div>
						<div class="panel-body">
							<div class="table-responsive">
								<table id="data-table" class="table table-striped table-bordered">
									<thead>
										<tr>
											<th>Nro </th>
											<th>Fecha</th>
											<th>Cliente</th>
											<th>Vendedor</th>
											<th>Fecha Entrega</th>
											<th>Descuento</th>
											<th>Subtotal</th>
											<th>Iva</th>
											<th>Total</th>

											<th>Estado</th>
											<th>Accion</th>
										</tr>
									</thead>
									<tbody>
										{% for p  in row %}
										{% if p.11 != True  and p.13 != True   %}
											<tr>
												<td><a onclick="detalledePedido({{ p.0 }})"> {{ p.1 }}</a></td>
												<td>{{ p.2 }}</td>
												<td>{{ p.3 }}</td>
												<td>{{ p.4 }}</td>
												<td>{{ p.5 }}</td>

												<td>{{ p.6 }}</td>
												<td>{{ p.7 }}</td>
												<td>{{ p.8 }}</td>
												<td>{{ p.9 }}</td>

												<td>{% if p.11 %}
														Aprobada
													{% elif p.13 %}
														Anulada
														{% else %}
														Esperando aprobacion
														{% endif %}



													{% if p.15 > 0  and p.12 != True %}
													  <span style="color: blue"> *Esperando Render</span>
													{% else %}
														{% if p.15 > 0  and p.12 == True %}
															   *Finalizado Render
															{% else %}

																{% endif %}
														{% endif %}
												</td>

												<td>

                                                    <a href="{% url 'aprobar-pedido' p.0 %}" onclick="return confirm('Esta seguro que desea aprobar el pedido {{ p.1 }}?')">
														<button type="button" class="btn btn-info btn-xs"><i class="fa fa-cog"></i> Aprobar</button>
													</a>
                                                       <a href="{% url 'anular-pedido' p.0 %}" onclick="return confirm('Esta seguro que desea anular el pedido {{ p.1 }}?')">
														<button type="button" class="btn btn-info btn-xs"><i class="fa fa-cog"></i> Anular</button>
													</a>
													{% if p.15 > 0  and p.12 != True %}
													{% else %}
														{% if p.15 > 0  and p.12 == True %}
															  <span class="input-group-btn input">
                                                <a href="javascript: render_ad('{{p.0}}')" class="btn btn-xs btn-default" data-toggle="modal">
													<i class="fa fa-camera">
													Ver Render
												</i></a></span>
															{% else %}

																{% endif %}
														{% endif %}
												</td>
											</tr >
											{% else %}
											{% endif %}
										{% endfor %}
									</tbody>
								</table>
							</div>

	<div class="panel-heading" style="background: #242a30;color:#fff">
							<div class="panel-heading-btn">
								<a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-default" data-click="panel-expand"><i class="fa fa-expand"></i></a>
								<a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-warning" data-click="panel-collapse"><i class="fa fa-minus"></i></a>
							</div>
							<h4 class="panel-title">Detalle de Pedido</h4>
						</div>
							<div class="table-responsive">
								<table id="detalle" class="table table-striped table-bordered">
									<thead>
										<tr>
											<th>Codigo</th>
											<th>Producto</th>
											<th>Cantidad</th>
											<th>Precio</th>
											<th>Total</th>
											<th>Reparacion</th>
											<th>Imagen</th>

										</tr>
									</thead>
									<tbody>

									</tbody>
								</table>
							</div>
						</div>
					</div>
					<!-- end panel -->

					<!-- #modal-dialog -->
					<div class="modal fade" id="modal-dialog">
						<div class="modal-dialog">
							<div class="modal-content">
							{% if form_mode == "update" %}
							<form method="post" action="{% url 'ordenescompra-update' ordenescompra.pk %}" data-parsley-validate="true" name="form-wizard" enctype="multipart/form-data">
							{% else %}
							<form method="post" action="{% url 'ordenescompra-create' %}" data-parsley-validate="true" name="form-wizard" enctype="multipart/form-data">
							{% endif %}
									{% csrf_token %}
									<div class="modal-header">
										<button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
										<h4 class="modal-title">Nueva Orden de Compra</h4>
									</div>
									<div class="modal-body">
									</div>
									<div class="modal-footer">
										<a href="javascript:;" class="btn btn-sm btn-white" data-dismiss="modal">Close</a>
										<button type="submit" class="btn btn-sm btn-success">Guardar</button>
									</div>
								</form>

							</div>
						</div>
					</div>
				</div>
				<!-- end col-12 -->
	<div aria-hidden="true" style="display: none;"  id="dlgRender" class="modal fade">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header text-center">
                    <button type="button" class="close" data-dismiss="modal">Ã—</button>
                    <h4 id="id_popup_render" class="modal-title"></h4>
                </div>
                <div class="modal-body">
                   <div id="contenido_dlgRender">
                       <div class="indicator show"><span class="spinner spinner16"></span></div>
                   </div>
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block javascript %}
{{ block.super }}

	<script type="text/javascript">
		  function render_ad(prefix){
            $("#id_popup_ingresos").html("<b>Render de Pedido</b>");




            var parametros = {
                'id': prefix,
                'csrfmiddlewaretoken': '{{ csrf_token }}'

            }

            $.ajax({
                    url: "/pedido/ver/"+prefix+"/imagenRender",
                    type: "POST",
                    async: true,
                    data: parametros,
                    success: function(data){
                        $('#contenido_dlgRender').html(data);



                    },
                    complete: function(){
                       $("#btn_guardar_render").show();
                    }
                });
            $('#dlgRender').modal();
        }



	function detalledePedido(id){
          $.ajax({
                url: "/config/obtenerDetallePedido/", // the endpoint
                type : "POST", // http method
                data : { id : id,'csrfmiddlewaretoken': '{{ csrf_token }}'}, 
                success:function(data){
                	
                  $("#detalle tbody tr").remove();

                  $("#detalle").append(data);
                },
                error: function(){
                 
                },
              });
    }
	</script>
	{% if form.errors or form_mode == "update" %}
	<script type="text/javascript">
		$( document ).ready(function() {
		    $(".modal").modal('toggle');
		});
	</script>

	{% endif %}
{% endblock %}
