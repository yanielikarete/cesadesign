{% extends "login/base-list.html" %}
{% load extra_filters %}

{% load staticfiles %}

{% block css %}
{{ block.super }}
{% endblock %}

{% block section_title %}Ordenes de Compra{% endblock %}
{% block section_subtitle %}
<br />
 <div class="email-btn-row hidden-xs">
                        <a href="{% url 'ordenescompra-create' %}" class="btn btn-sm btn-success"><i class="fa fa-plus m-r-5"></i> Nueva Orden</a>
                    </div>

                    {% endblock %}

{% block content %}
				<!-- begin col-12 -->
				<div class="col-md-12">
					<!-- begin panel -->
					<div class="panel panel-inverse">
						<div class="panel-heading">
							<div class="panel-heading-btn">
								<a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-default" data-click="panel-expand"><i class="fa fa-expand"></i></a>
								<a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-warning" data-click="panel-collapse"><i class="fa fa-minus"></i></a>
							</div>
							<h4 class="panel-title">Ordenes de Compra</h4>
						</div>
					    <div class="panel-body">
                            <div class="table-responsive">
                                <table id="data-table" class="table table-striped table-bordered">
                                    <thead>
                                        <tr>
                                            <th>Nro Compra</th>
                                            <th>Proveedor</th>
                                            <th>Total</th>
                                            <th>Concepto</th>
                                            <th>Fecha</th>
                                            <th>Estado</th>
                                            <th>Accion</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for ordenescompra  in ordenesdecompras %}
                                            <tr>
                                                <td><a onclick="detalledeCompra({{ ordenescompra.0 }})"> {{ ordenescompra.1 }}</a></td>
                                                <td>{{ ordenescompra.2 }}</td>
                                                <td>{{ ordenescompra.3 }}</td>
                                                <td>{{ ordenescompra.4 }}</td>
                                                <td>{{ ordenescompra.5 }}</td>

                                                <td>{% if ordenescompra.6 %}
                                                Aprobada
                                                {% elif ordenescompra.7 %}
                                                        Anulada
                                                        {% else %}
                                                        Esperando aprobación
                                                        {% endif %}
                                                </td>

                                                <td>
                                                    {% if ordenescompra.6 %}
				{% if ordenescompra.8 == False %}
				                      {% if ordenescompra.9 %}
				                      {% else %}
					<a href="{% url 'ordenes-compraslocales-create' ordenescompra.0  %}">
					    <button type="button" class="btn btn-info btn-xs"><i class="fa fa-cog"></i> Factura</button>
					</a>
				{% endif %}
				{% endif %}

                                                    {% else %}
		      {% if ordenescompra.9 %}
				                      {% else %}
			<a href="{% url 'ordenescompra-actualizar' ordenescompra.0 %}">
			    <button type="button" class="btn btn-info btn-xs"><i class="fa fa-cog"></i> Editar</button>
			</a>
			                                                    {% endif %}

                                                    {% endif %}
                                                    <a href="{% url 'ordencompra-imprimir' ordenescompra.0 %}">
                                                        <button type="button" class="btn btn-info btn-xs"><i class="fa fa-cog"></i> Imprimir</button>
                                                    </a>
                                                </td>
                                            </tr >
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>



<h4 class="panel-title">Detalle de Ordenes de Compra</h4>
							<div class="table-responsive">
								<table id="detalle" class="table table-striped table-bordered">
									<thead>
										<tr>
											<th>Codigo</th>
											<th>Producto</th>
											<th>Cantidad</th>
											<th>Precio</th>
											<th>Total</th>
											
										</tr>
									</thead>
									<tbody>
										
									</tbody>
								</table>
							</div>
						</div>
					</div>
					<!-- end panel -->

					<!-- #modal-dialog -->
					<div class="modal fade" id="modal-dialog">
						<div class="modal-dialog">
							<div class="modal-content">
							{% if form_mode == "update" %}
							<form method="post" action="{% url 'ordenescompra-update' ordenescompra.pk %}" data-parsley-validate="true" name="form-wizard" enctype="multipart/form-data"> 
							{% else %}
							<form method="post" action="{% url 'ordenescompra-create' %}" data-parsley-validate="true" name="form-wizard" enctype="multipart/form-data"> 
							{% endif %}
									{% csrf_token %}
									<div class="modal-header">
										<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
										<h4 class="modal-title">Nueva Orden de Compra</h4>
									</div>
									<div class="modal-body">
									</div>
									<div class="modal-footer">
										<a href="javascript:;" class="btn btn-sm btn-white" data-dismiss="modal">Close</a>
										<button type="submit" class="btn btn-sm btn-success">Guardar</button>
									</div>
								</form>

							</div>
						</div>
					</div>
				</div>
				<!-- end col-12 -->	
			
{% endblock %}

{% block javascript %}
{{ block.super }}

   
	<script type="text/javascript">
		

	function detalledeCompra(id){
          $.ajax({
                url: "/config/obtenerDetalleCompra/", // the endpoint
                type : "POST", // http method
                data : { id : id,'csrfmiddlewaretoken': '{{ csrf_token }}'}, 
                success:function(data){
                  $("#detalle").append(data);
                },
                error: function(){
                 
                },
              });
    }
	</script>
	<!-- ================== END PAGE LEVEL JS ================== -->
	{% if form.errors or form_mode == "update" %}
	<script type="text/javascript">
		$( document ).ready(function() {
		    $(".modal").modal('toggle');
		});
	
	</script>
	{% endif %}
{% endblock %}
