{% extends "login/base-list.html" %}
{% load extra_filters %}

{% load staticfiles %}

{% block css %}
{{ block.super }}
{% endblock %}

{% block section_title %}Recepcion de Bodega{% endblock %}
{% block section_subtitle %}
<br />
 <div class="email-btn-row hidden-xs">

                    </div>

                    {% endblock %}

{% block content %}
				<!-- begin col-12 -->
		<form method="post" data-parsley-validate="true" name="form-wizard" enctype="multipart/form-data"> {% csrf_token %}

				<div class="col-md-12">
					<!-- begin panel -->
					<div class="panel panel-inverse">
						<div class="panel-heading">
							<div class="panel-heading-btn">
								<a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-default" data-click="panel-expand"><i class="fa fa-expand"></i></a>
								<a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-warning" data-click="panel-collapse"><i class="fa fa-minus"></i></a>
							</div>
							<h4 class="panel-title">Recepcion de Ordenes de Produccion</h4>
						</div>
						<div class="panel-body">
							<div class="table-responsive">
								<table id="data-table" class="table table-striped table-bordered">
									<thead>
										<tr>

											<th>Orden Produccion</th>
											<th>Cliente</th>

											<th>Producto</th>
											<th>Cantidad</th>
											<th>Cantidad Recibida</th>

											<th>Medida</th>
											<th>Ambiente</th>
                      <th>Bodega</th>

											<th width="200px">Observaciones</th>
											<th>Estado</th>

											<th>Accion</th>

										</tr >
									</thead>
									<tbody>
										{% for orden  in subordenes %}
											<tr>
												<td>
												<input type="hidden" id="suborden_id{{ forloop.counter }}" name="suborden_id{{ forloop.counter }}" value="{{ orden.id }}">
												{{ orden.orden_produccion.tipo }} {{ orden.orden_produccion.codigo }}
                                                     </td>
												<td>{{ orden.orden_produccion.cliente }}
                                                     </td>
												<td>{{ orden.producto }}
                                                     </td>
												<td>{{ orden.cantidad }}</td>
												<td>
                       <!--  <input type="text" class="form-control" value="{{ orden.cantidad_recibida }}" id="cantidad_guardar{{ forloop.counter }}" name="cantidad_guardar{{ forloop.counter }}"/> -->
                        {{ orden.cantidad_recibida }}</td>
												<td>Largo:{{ orden.largo }}
                        Fondo:{{ orden.fondo }}
                        Alto:{{ orden.alto }}
                                                     </td>
                                                <td>{{ orden.ambiente }}
                                                </td>
                                                <td>{{ orden.bodega }}</td>
												<td>
                       <!--  <textarea name="observaciones{{ forloop.counter }}"  id="observaciones{{ forloop.counter }}" cols="30" rows="5">
													{{ orden.observaciones }}
												</textarea> -->
                        {{ orden.observaciones }}
                        </td>


<td>{% if orden.ingresado_bodega %}
												Recibido en bodega

														{% else %}
                                                        {% if orden.numero_orden_ingreso >= 0 %}
                                                        Esperando Aprobacion de Orden de Ingreso
                                                                                                                                {% else %}
                                                                                                        En Proceso


                                                        {% endif %}
														{% endif %}
												</td>
												<td>
												{% if orden.ingresado_bodega %}
                        {% else %}
                                                    {% if orden.cantidad_recibida  %}
                                                        {% if orden.numero_orden_ingreso <= 0 %}
                                                                              <a href="{% url 'orden-ingreso-nuevo-recepcion' orden.id %}">
                                                                            <button type="button" class="btn btn-info btn-xs"><i class="fa fa-cog"></i> Orden de Ingreso</button> </a>
                                                        {% endif %}
                                                    {% else %}
                                                    <p style="color:red">*No ha ingresado la cantidad Recibida</p>
                                                    {% endif %}
                            {% endif %}

													<a href="{% url 'recepcionbodega-editar' orden.id %}">
												<button type="button" class="btn btn-info btn-xs"><i class="fa fa-cog"></i> Editar</button>	</a>
											</td>

											</tr >
										{% endfor %}

									</tbody>
								</table>
							</div>
<!--
                                    <button type="submit" class="btn btn-primary btn-lg"><i class="fa fa-cog"></i> Guardar</button> -->

						</div>
					</div>
					{% if subordenes %}
<input type="hidden" name="columnas_receta" id="columnas_receta" value="{{ subordenes|length }}" />
{% else %}
<input type="hidden" name="columnas_receta" id="columnas_receta" value="1" />

{% endif %}
 </form>

					<!-- end panel -->

					<!-- #modal-dialog -->

				</div>
				<!-- end col-12 -->

{% endblock %}

{% block javascript %}
{{ block.super }}



	<script type="text/javascript">
		  $(document).ready(function() {

   cambiarFormato();
  });
function cambiarFormato(){
      var num_recetas=$('#columnas_receta').val();
      //alert(num_recetas);
      var total=0;
      var costo1=0;
      var subt=0;
      var i;
      //alert(' BNUM RECETS'+num_recetas);
      for (i = 1; i <= num_recetas; i++) {
        costo1= $('#cantidad_guardar'+i).val();
        costo1 = costo1.toString().replace(/\,/g,'.');
        $('#cantidad_guardar'+i).val(costo1);

      }



    }
	function detalledeCompra(id){
          $.ajax({
                url: "/config/obtenerDetalleCompra/", // the endpoint
                type : "POST", // http method
                data : { id : id,'csrfmiddlewaretoken': '{{ csrf_token }}'},
                success:function(data){
                  $("#detalle").append(data);
                },
                error: function(){

                },
              });
    }
      function agregar(id){
       var ambiente=$("#ambientes").val();
	   var secuencia=$("#secuencia").val();
          $.ajax({
                url: "/subordenproduccion/agregarSubordenproduccion/", // the endpoint
                type : "POST", // http method
                data : { id : id,secuencia : secuencia,ambiente : ambiente,'csrfmiddlewaretoken': '{{ csrf_token }}'},
                success:function(data){
                  alert("Se  agrego satisfactoriamente")
                  window.location.href ="/subordenproduccion/subordenproduccion/"+id+"/list";
                },
                error: function(){

                },
              });
    }
    function eliminar(id,pk){

          $.ajax({
                url: "/subordenproduccion/eliminarSubordenproduccion/", // the endpoint
                type : "POST", // http method
                data : { id : id,'csrfmiddlewaretoken': '{{ csrf_token }}'},
                success:function(data){
                  alert("Se elimino el item satisfactoriamente");
                  window.location.href ="/subordenproduccion/subordenproduccion/"+pk+"/list";

                },
                error: function(){

                },
              });
    }

      function enviarBodega(id){

          $.ajax({
                url: "/subordenproduccion/subordenproduccion/enviarBodega/", // the endpoint
                type : "POST", // http method
                data : { id : id,'csrfmiddlewaretoken': '{{ csrf_token }}'},
                success:function(data){
                  alert("Se  envio a bodega satisfactoriamente, se cerro la etapa de costeo")
                },
                error: function(){
                  alert("Verifique si ha terminado todas las etapas y si ha creado el producto")

                },
              });
    }
     function finalizar(id){
      var num_recetas=$('#columnas_receta').val();
      var total=0;
      var cantidad=0;
      var i;
      //alert(' BNUM RECETS'+num_recetas);
      for (i = 1; i <= num_recetas; i++) {
      	if( $('#finalizada'+i).prop('checked') ) {
      			total++;
					}



      }

      if(total==num_recetas){
      	 window.location.href ="/inventario/producto/"+id+"/nuevo_orden_produccion";

      }else{
      	alert("Debe finalizar todas las etapas")
      }
    }
	</script>
	<!-- ================== END PAGE LEVEL JS ================== -->
	{% if form.errors or form_mode == "update" %}
	<script type="text/javascript">
		$( document ).ready(function() {
		    $(".modal").modal('toggle');
		});

	</script>
	{% endif %}
{% endblock %}
