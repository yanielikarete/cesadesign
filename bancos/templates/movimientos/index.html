{% extends "login/base-list.html" %}
{% load extra_filters %}
{% load staticfiles %}

{% block css %}
    {{ block.super }}

{% endblock %}

{% block section_title %}
    Consulta de movimientos bancarios
{% endblock %}

{% block section_subtitle %}
    <br/>
    <div class="email-btn-row hidden-xs" style="margin-left: 1.4%;">
        <a href="{% url 'movimiento-nuevo' %}" class="btn btn-sm btn-inverse">
            <i class="fa fa-plus m-r-5"></i>
            Nuevo
        </a>
    </div>
{% endblock %}

{% block content %}
    <!-- begin col-12 -->
    <div class="col-md-12">
        <!-- begin panel -->
        <div class="panel panel-inverse">
            <div class="panel-heading">
                <div class="panel-heading-btn">
                    <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-default" data-click="panel-expand">
                        <i class="fa fa-expand"></i>
                    </a>
                    <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-warning"
                       data-click="panel-collapse">
                        <i class="fa fa-minus"></i>
                        Listado de movimientos
                    </a>
                </div>
                <h4 class="panel-title"></h4>
                				 {% csrf_token %}

            </div>
            <div class="panel-body">
                <div class="table-responsive">
                    <table id="data-movimiento" class="table table-striped table-bordered">
                        <thead>
                        <tr>
                            
                            <th>Emisión</th> <th>Tipo</th>
                            <th>N° Comprobante</th>
                            <th>Persona</th>
                            <th>RUC</th>
                            <th>Transacción</th>
                            <th>No. Cheque</th>
                            <th>Cuenta bancaria</th>
                             <th>Valor del Cheque</th>
                            <th>Total</th>
                            <th>Descripcion</th>

                            <th>Estado</th>
                            <th width="100">Acción</th>
                        </tr>
                        </thead>
                        <tbody></tbody>
                       <!-- <tbody>
                        {% for movimiento  in movimientos %}
                            <tr>
                                    <td>{{ movimiento.tipo_anticipo.descripcion }}</td>
                                <td>{{ movimiento.fecha_emision | date:'Y-m-d' }}</td>
                                <td>{{ movimiento.numero_comprobante }}</td>
                                {% if movimiento.cliente%}
                                <td>{{ movimiento.cliente.nombre_cliente}}</td>
                                {% else %}
                                <td>{{ movimiento.proveedor}}</td>
                                {% endif %}
                                 {% if movimiento.cliente%}
                                <td>{{ movimiento.cliente.ruc}}</td>
                                {% else %}
                                <td>{{ movimiento.proveedor.ruc}}</td>
                                {% endif %}
                                <td>{{ movimiento.tipo_documento.descripcion }}</td>
                                <td>{{ movimiento.numero_cheque }}</td>

                                <td>{{ movimiento.banco.nombre }} - {{movimiento.banco.tipo_cuenta}}</td>
                                
                                <td>
                                     {% if movimiento.tipo_documento.descripcion == "Cheque"  %}
                                {{ movimiento.monto_cheque }}
                                {% else %}
                                -
                                {% endif %}
                                    
                                    
                                    </td>
                                <td>{{ movimiento.monto }}</td>
                                <td>{{ movimiento.descripcion }}</td>

                                <td>
                                    {% if movimiento.activo %}
                                    Activo
                                 {% else %}
                                Anulado
                                {% endif %}
                                </td>
                                <td>
                                     {% if movimiento.conciliacion_id  %}
                                     
                                      {% else %}
                                
                                            {% if movimiento.activo %}
                                            <a href="{% url 'movimiento-edit' movimiento.id %}">
                                               <button type="button" class="btn btn-primary btn-xs">
                                                   <i class="fa fa-pencil-square-o icon-white"></i>
                                               </button>
                                           </a>
                                        {% else %}
                                       {% endif %}
                                          
       
                                           <a href="{% url 'movimiento-delete-pk' movimiento.id %}" onclick="return confirm('¿Está seguro de borrar este movimiento?')">
                                               <button type="button" class="btn btn-danger btn-xs">
                                                   <i class=" glyphicon glyphicon-trash icon-white"></i>
                                               </button>
                                           </a>
                                    {% endif %}
                                    {% if movimiento.tipo_documento.descripcion == "Cheque" %}
                                    <a href="{% url 'bancos-imprimir-cheque-actual' movimiento.id %}" target="_blank" title="Imprimir cheque">
                                        <button type="button" class="btn btn-default btn-xs">
                                            <i class="fa fa-money"></i>
                                        </button>
                                    </a>
                                    
                                    
                                    
                                    {% endif %}
                                  <a href="{% url 'movimiento-consultar-cheque' movimiento.id %}" >
                                        <button type="button" class="btn btn-default btn-xs">
                                            <i class="fa fa-eye"></i>
                                        </button>
                                    </a>
                                   
                                     <a href="{% url 'movimiento-comprobante-egreso' movimiento.id %}" target="_blank" title="Imprimir comprobante">
                                        <button type="button" class="btn btn-default btn-xs">
                                            <i class="fa fa-file-text-o"></i>
                                        </button>
                                    </a>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>-->
                    </table>
                </div>
            </div>
        </div>
        <!-- end panel -->
        <!-- #modal-dialog -->
    </div>
    <!-- end col-12 -->
{% endblock %}

{% block javascript %}
    {{ block.super }}
    <script>
         $(document).ready(function () {
            $('#data-movimiento').DataTable({
                 "processing": true,
                 "serverSide": true,
                 "ajax": "/bancos/movimiento/api",
                 "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
				 "order": [[ 6, "desc" ]],
                 dom: 'Blfrtip',
	buttons: [
	    'csv', 'excel', 'pdf'
	]
                  
            });
        });


//$(document).ready(function () {
//		 $('#data-movimiento').DataTable({
//                 "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
//                 dom: 'Blfrtip',
//	buttons: [
//	    'csv', 'excel', 'pdf'
//	]
//                  
//            });
//		 $('#data-movimiento tbody').html("");
//		 var t = $('#data-movimiento').DataTable();
//                    $.ajax({
//                    type: "POST",
//                    url: "{% url 'movimiento-api' %}",
//                    data: {
//                        csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val()
//                    },
//                    success: function(response) {
//                        
//                            
//                        for (var i = 0; i < response.length; i++) {
//							
//                        var factura =
//                        '<tr>' +
//                        '<td>' + response[i][1]+ '</td>' +
//                        '<td>' + response[i][2]+ '</td>' +
//                        '<td>' + response[i][3] + '</td>' +
//                        '<td>' + response[i][4]+ '</td>' +
//                        '<td>' + response[i][5] + '</td>' +
//						'<td>' + response[i][6] + '</td>' +
//						'<td>' + response[i][7] + '</td>' +
//						'<td>' + response[i][8] + '</td>' +
//                        '<td>' + response[i][9] + '</td>' +
//                        '<td>' + response[i][10] + '</td>' +
//                        '<td>' + response[i][11] + '</td>';
//                        
//                        if (response[i][13]== true){
//                                if (response[i][12]== true ){
//                                    factura +='<td>Activo</td>';
//                                    factura +='<td>';
//                                    factura +='<a href="/bancos/movimiento/'+response[i][0]+'/imprimir_cheque_actual" style=""><button type="button" class="btn btn-default btn-xs"><i class="fa fa fa-money"></i></button></a>';
//                                    factura +='<a href="/bancos/movimiento/'+response[i][0]+'/consultar_cheque" style=""><button type="button" class="btn btn-default btn-xs"><i class="fa fa-eye"></i></button></a>';
//                                    factura +='<a href="/bancos/movimiento/'+response[i][0]+'/imprimir_orden_egreso" style=""><button type="button" class="btn btn-default btn-xs"><i class="fa fa fa-file-text-o"></i></button></a>';
//                                    factura +='</td>';
//                   
//                                }else{
//                                    factura +='<td>Anulado</td>';
//                                    factura +='<td>';
//                                    factura +='<a href="/bancos/movimiento/'+response[i][0]+'/imprimir_cheque_actual" style=""><button type="button" class="btn btn-default btn-xs"><i class="fa fa fa-money"></i></button></a>';
//                                    factura +='<a href="/bancos/movimiento/'+response[i][0]+'/consultar_cheque" style=""><button type="button" class="btn btn-default btn-xs"><i class="fa fa-eye"></i></button></a>';
//                                    factura +='<a href="/bancos/movimiento/'+response[i][0]+'/imprimir_orden_egreso" style=""><button type="button" class="btn btn-default btn-xs"><i class="fa fa fa-file-text-o"></i></button></a>';
//                                    factura +='</td>';
//
//
//                                    }
//                                 
//                        }
//                        else{
//                            
//                              if (response[i][12]== true ){
//                                factura +='<td>Activo</td>';
//                                
//                                factura +='<td>';
//                                factura +='<a href="/bancos/movimiento/'+response[i][0]+'/editar" style=""><button type="button" class="btn btn-primary btn-xs"><i class="fa fa-pencil-square-o icon-white"></i></button></a>';
//                                factura +='<a href="/bancos/movimiento/'+response[i][0]+'/eliminar" style=""><button type="button" class="btn btn-danger btn-xs"><i class=" glyphicon glyphicon-trash icon-white"></i></button></a>';
//                                factura +='<a href="/bancos/movimiento/'+response[i][0]+'/imprimir_cheque_actual" style=""><button type="button" class="btn btn-default btn-xs"><i class="fa fa fa-money"></i></button></a>';
//                                factura +='<a href="/bancos/movimiento/'+response[i][0]+'/consultar_cheque" style=""><button type="button" class="btn btn-default btn-xs"><i class="fa fa-eye"></i></button></a>';
//                                factura +='<a href="/bancos/movimiento/'+response[i][0]+'/imprimir_orden_egreso" style=""><button type="button" class="btn btn-default btn-xs"><i class="fa fa fa-file-text-o"></i></button></a>';
//                                factura +='</td>';
//                   
//                                }
//                                else{
//                                    factura +='<td>Anulado</td>';
//                                    factura +='<td>';
//                                    factura +='<a href="/bancos/movimiento/'+response[i][0]+'/imprimir_cheque_actual" style=""><button type="button" class="btn btn-default btn-xs"><i class="fa fa fa-money"></i></button></a>';
//                                    factura +='<a href="/bancos/movimiento/'+response[i][0]+'/consultar_cheque" style=""><button type="button" class="btn btn-default btn-xs"><i class="fa fa-eye"></i></button></a>';
//                                    factura +='<a href="/bancos/movimiento/'+response[i][0]+'/imprimir_orden_egreso" style=""><button type="button" class="btn btn-default btn-xs"><i class="fa fa fa-file-text-o"></i></button></a>';
//                                    factura +='</td>';
//
//
//                                    }
//                            
//                            
//                        }
//						
//                        factura +='</tr>';
//                        
//						t.row.add($(factura)).draw();
//
//                        }
//						
//                        
//                    },
//                    error: function(response) {
//                        //alert("El banco no tiene movimientos asociados .");
//                    }
//                });
//   
//            
//          
//         
//        });
//    </script>

{% endblock %}



