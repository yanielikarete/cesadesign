{% extends "login/base-create.html" %}
{% load staticfiles %}
{# Load the tag library #}
{% load bootstrap3 %}
{# Load CSS and JavaScript #}
{% bootstrap_javascript %}
{# Display django.contrib.messages as Bootstrap alerts #}
{% bootstrap_messages %}
{% block css %}
    {{ block.super }}
    <!-- ================== BEGIN PAGE LEVEL STYLE ================== -->
    <!-- ================== END PAGE LEVEL STYLE ================== -->
{% endblock %}
{% block section_title %} Crear Conciliaci贸n {% endblock %}
{% block section_subtitle %}Por favor diligencie el siguiente formulario{% endblock %}
{% block content %}
    <style>
        .panel-border {
            border: 1px solid #ddd !important;
        }
        .form-group {
            margin-bottom: 0px !important;
        }
    </style>
    <div class="row">
        <!-- begin col-6 -->
        <div class="col-md-12">
            <div class="panel-heading">
                <div class="panel panel-inverse">
                    <div class="panel-heading">
                        <h3 class="panel-title">
                            <a aria-expanded="true" class="accordion-toggle accordion-toggle-styled"
                               data-toggle="collapse" data-parent="#accordion" href="#collapseOne">
                                <i class="fa fa-plus-circle pull-right"></i>
                                Informaci贸n de la conciliaci贸n
                            </a>
                        </h3>
                    </div>
                    <div id="collapseOne" aria-expanded="true" id="collapseOne"
                         class="panel-collapse collapse in">
                        <div class="panel-body panel-border">
                            <form  id="formulario" class="form-horizontal" method="post">
                                {% csrf_token %}
                                <div class="form-group">
                                    <label class="control-label col-md-4">Fecha de corte</label>
                                    <div class="col-md-4">
                                        <input type="date" class="form-control" name="fecha_corte" id="fecha_corte" required>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-4 control-label" for="cuenta_banco">Cuenta de banco</label>
                                    <div class="col-sm-4">
                                        <select class="form-control" name="cuenta_banco" required>
                                            <option value="" selected>Seleccione una cuenta de banco
                                            </option>
                                            {% for cuenta_banco in cuentas_bancos %}
                                                <option value="{{ cuenta_banco.id }}">{{ cuenta_banco.nombre }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-4 control-label"
                                           for="descripcion">Descripci贸n</label>
                                    <div class="col-sm-4">
                                        <input class="form-control" type="text" name="descripcion" required>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-4 control-label" for="saldo_estado_cuenta">Saldo estado
                                        cuenta</label>
                                    <div class="col-sm-4">
                                        <input class="form-control" type="number" name="saldo_estado_cuenta" step="0.01"
                                               value="0.00"
                                               required>
                                    </div>
                                </div>
                               <div class="form-group">
                                    <label class="col-sm-4 control-label"
                                           for="estado">Estado</label>
                                    <div class="col-sm-4">
                                        <select class="form-control" name="estado" required>
                                            <option value="" selected>Seleccione un estado</option>
                                            <option value="True">Concluida</option>
                                            <option value="False">Pendiente</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="panel panel-inverse">
                                                 <div class="panel-body">
                        <div class="col-md-12">
                            <div>

                                <!-- Nav tabs -->
                                <ul class="nav nav-tabs" role="tablist">
                                  <li role="presentation" class="active"><a href="#principales" aria-controls="principales" role="tab" data-toggle="tab">Movimientos</a></li>
                                 
                                  <li role="presentation"><a href="#cheques" aria-controls="cheques" role="tab" data-toggle="tab">Cheques</a></li>
                                <li role="presentation"><a href="#depositos" aria-controls="depositos" role="tab" data-toggle="tab">Depositos</a></li>
                                  <li role="presentation"><a href="#nc" aria-controls="foto" role="tab" data-toggle="tab">Notas de Credito</a></li>
                                  <li role="presentation"><a href="#nd" aria-controls="foto" role="tab" data-toggle="tab">Notas de Debito</a></li>
                                </ul>
                              
                                <!-- Tab panes -->
                                <div class="tab-content">
                                    <div role="tabpanel" class="tab-pane fade in active" id="principales">
                                                   <table class="table2 table table-striped table-bordered dataTable no-footer dtr-inline"
                                               id="tabla-movimientos" >
                                            <thead>
                                            <tr>
                                                <th>Fecha</th>
                                                <th>Documento</th>
                                                <th>No.Comprobante</th>
                                                <th>Documento</th>
                                                <th  width="130px">Detalle</th>
                                                <th>No. Cheque</th>
                                                <th>Monto</th>
                                             <th style="width:30px !important">Conciliar</th>

                                            </tr>
                                            </thead>
                                            <tbody>
                                            </tbody>
                                            <tfoot>
                                                <tr>
                                                     <th></th>
                                                <th></th>
                                                <th><th>
                                                <th></th>
                                                
                                                <th>Total</th>
                                             <th colspan="2"><input type="text" name="total" id="total"/></th>

                                                </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                               
                        
                                    
                                   
                                    <div role="tabpanel" class="tab-pane fade" id="cheques">
                                   <table class="table2 table table-striped table-bordered dataTable no-footer dtr-inline"
                                               id="tabla-cheques">
                                            <thead>
                                            <tr>
                                                <th>Fecha</th>
                                                <th>Documento</th>
                                                <th>No.Comprobante</th>
                                                <th>Documento</th>
                                                <th>Detalle</th>
                                                <th>No. Cheque</th>
                                                <th>Monto</th>
                                             <th style="width:30px !important">Conciliar</th>

                                            </tr>
                                            </thead>
                                            <tbody>
                                            </tbody>
                                            <tfoot>
                                                <tr>
                                                     <th></th>
                                                <th></th>
                                                <th><th>
                                                <th></th>
                                                <th>Total</th>
                                             <th  colspan="2"><input type="text" name="total_cheques" id="total_cheques"/></th>

                                                </tr>
                                            </tfoot>
                                        </table>
                                 
                                    </div>
                                
                              
                                 
                                 
                                 
                                  <div role="tabpanel" class="tab-pane fade" id="depositos">
                                   <table class="table2 table table-striped table-bordered dataTable no-footer dtr-inline"
                                               id="tabla-depositos">
                                            <thead>
                                            <tr>
                                                <th>Fecha</th>
                                                <th>Documento</th>
                                                <th>No.Comprobante</th>
                                                <th>Documento</th>
                                                <th>Detalle</th>
                                                <th>Monto</th>
                                             <th style="width:30px !important">Conciliar</th>

                                            </tr>
                                            </thead>
                                            <tbody>
                                            </tbody>
                                            <tfoot>
                                                <tr>
                                                <th></th>
                                                <th><th>
                                                <th></th>
                                                <th>Total</th>
                                             <th  colspan="2"><input type="text" name="total_depositos" id="total_depositos"/></th>

                                                </tr>
                                            </tfoot>
                                        </table>
                                 
                                    </div>
                                
                              
                            
                                 <div role="tabpanel" class="tab-pane fade" id="nc">
                                              <table class="table2 table table-striped table-bordered dataTable no-footer dtr-inline"
                                               id="tabla-nc">
                                            <thead>
                                            <tr>
                                                <th>Fecha</th>
                                                <th>Documento</th>
                                                <th>No.Comprobante</th>
                                                <th>Documento</th>
                                                <th>Detalle</th>
                                                
                                                <th>Monto</th>
                                             <th style="width:30px !important">Conciliar</th>

                                            </tr>
                                            </thead>
                                            <tbody>
                                            </tbody>
                                            <tfoot>
                                                <tr>
                                                     <th></th>
                                                <th></th>
                                                
                                                <th></th>
                                                <th>Total</th>
                                             <th  colspan="2"><input type="text" name="total_nc" id="total_nc"/></th>

                                                </tr>
                                            </tfoot>
                                        </table>
                                 
                                    </div>
                                    <div role="tabpanel" class="tab-pane fade" id="nd">
                                              <table class="table2 table table-striped table-bordered dataTable no-footer dtr-inline"
                                               id="tabla-nd">
                                            <thead>
                                            <tr>
                                                <th>Fecha</th>
                                                <th>Documento</th>
                                                <th>No.Comprobante</th>
                                                <th>Documento</th>
                                                <th>Detalle</th>
                                                <th>Monto</th>
                                             <th style="width:30px !important">Conciliar</th>

                                            </tr>
                                            </thead>
                                            <tbody>
                                            </tbody>
                                            <tfoot>
                                                <tr>
                                                     <th></th>
                                                <th></th>
                                                <th><th>
                                                <th>Total</th>
                                             <th  colspan="2"><input type="text" name="total_nd" id="total_nd"/></th>

                                                </tr>
                                            </tfoot>
                                        </table>
                                 
                                    </div>
                                
                              
                               
                                    </div>
                                
                                
                                
                                
                                </div>
                              
                            </div>
                        </div>
                       
</div>
         
                                 
                                <button type="submit" class="btn btn-inverse"><i class="fa fa-save"></i> Guardar
                                </button>
                            </form>
                        </div>
                    
                    
                     <div class="form-group">
                                    <table class="table2 table table-striped table-bordered dataTable no-footer dtr-inline">
                                        <thead>
                                        <th></th>
                                       
                                    <th>Cheques</th>
                                    <th>Depositos</th>
                                    <th>Nota de Credito</th>
                                    <th>Nota de Debito</th>
                                     <th>Total</th>
                                    </thead>
                                        <tbody>
                                           
                                            <tr>
                                            <td>Monto .Conciliados</td>
                                            <td><input type="text" name="montoc_c" id="montoc_c" readonly="readonly"></td>
                                            <td><input type="text" name="montoc_d" id="montoc_d" readonly="readonly"></td>
                                            <td><input type="text" name="montoc_nc" id="montoc_nc" readonly="readonly"></td>
                                            <td><input type="text" name="montoc_nd" id="montoc_nd" readonly="readonly"></td>
                                            <td><input type="text" name="montoc_m" id="montoc_m" readonly="readonly"></td>
                                            
                                            </tr>
                                             <tr>
                                            <td>Cant.Conciliados</td>
                                            <td><input type="text" name="totalc_c" id="totalc_c" readonly="readonly"></td>
                                            <td><input type="text" name="totalc_d" id="totalc_d" readonly="readonly"></td>
                                            <td><input type="text" name="totalc_nc" id="totalc_nc" readonly="readonly"></td>
                                            <td><input type="text" name="totalc_nd" id="totalc_nd" readonly="readonly"></td>
                                            <td><input type="text" name="totalc_m" id="totalc_m" readonly="readonly"></td>
                                            
                                            </tr>
                                            
                                            <tr>
                                            <td>Monto No Conciliados</td>
                                            <td><input type="text" name="montonc_c" id="montonc_c" readonly="readonly"></td>
                                            <td><input type="text" name="montonc_d" id="montonc_d" readonly="readonly"></td>
                                            <td><input type="text" name="montonc_nc" id="montonc_nc" readonly="readonly"></td>
                                            <td><input type="text" name="montonc_nd" id="montonc_nd" readonly="readonly"></td>
                                            <td><input type="text" name="montonc_m" id="montonc_m" readonly="readonly"></td>
                                            
                                            </tr>
                                            <tr>
                                            <td>Cant.No Conciliados</td>
                                            <td><input type="text" name="totalnc_c" id="totalnc_c" readonly="readonly"></td>
                                            <td><input type="text" name="totalnc_d" id="totalnc_d" readonly="readonly"></td>
                                            <td><input type="text" name="totalnc_nc" id="totalnc_nc" readonly="readonly"></td>
                                            <td><input type="text" name="totalnc_nd" id="totalnc_nd" readonly="readonly"></td>
                                            <td><input type="text" name="totalnc_m" id="totalnc_m" readonly="readonly"></td>
                                            
                                            </tr>
                                            
                                          <!--  <tr>
                                            <td>Monto Total</td>
                                            <td><input type="text" name="monto_c" id="monto_c"></td>
                                            <td><input type="text" name="monto_d" id="monto_d"></td>
                                            <td><input type="text" name="monto_nc" id="monto_nc"></td>
                                            <td><input type="text" name="monto_nd" id="monto_nd"></td>
                                            <td><input type="text" name="monto_m" id="monto_m"></td>
                                            
                                            </tr>
                                            <tr>
                                            <td>Cant. Total</td>
                                            <td><input type="text" name="total_c" id="total_c"></td>
                                            <td><input type="text" name="total_d" id="total_d"></td>
                                            <td><input type="text" name="total_nc" id="total_nc"></td>
                                            <td><input type="text" name="total_nd" id="total_nd"></td>
                                            <td><input type="text" name="total_m" id="total_m"></td>
                                            
                                            </tr>-->
                                        </tbody>
                                    </table>
                                </div>
                    
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
        </div>
{% endblock %}
{% block javascript %}
    {{ block.super }}
    <script src="{% static 'color_admin/assets/plugins/parsley/src/parsley.js' %}"></script>
    <script>
        $('#fecha_corte').datepicker({todayHighlight: true, autoclose: true,format: 'yyyy-mm-dd'});
        $("select[name='cuenta_banco']").change(function () {
        var selected = $(this).find('option:selected');
            if (selected.val() != "") {
                var id = selected.val();
               var fecha=$("#fecha_corte").val();
     //agregar_asiento();
    // alert(fecha);
                
                 $.ajax({
                    type: "POST",
                    url: "{% url 'consultar-movimiento-conciliar' %}",
                    data: {
                        'id': id,
                        'fecha': fecha,
                        csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val()
                    },
                    success: function(response) {
                        
                                    $('#tabla-movimientos tbody').html("");
                           $('#tabla-cheques tbody').html("");
                            $('#tabla-depositos tbody').html("");
                            $('#tabla-nc tbody').html("");
                             $('#tabla-nd tbody').html("");
                        for (var i = 0; i < response.length; i++) {
                           // cargarfacturas(id, fecha_emision,documento, paguese,descripcion, numero_cheque, monto, monto_cheque,numero_comprobante,tipo,debe,haber,conciliacion_id) {
                        cargarfacturas(response[i][0], response[i][4], response[i][2],response[i][5], response[i][6], response[i][9], response[i][10], response[i][11], response[i][8],response[i][12],response[i][14],response[i][15],response[i][16],response[i][18]);
                        }
                                            seleccionar_check();
                        
                    },
                    error: function(response) {
                        alert("El banco no tiene movimientos asociados .");
                    }
                });
   
            
          
          $("#tabla-movimientos").dataTable().fnDestroy();
            if ( $.fn.dataTable.isDataTable( '#tabla-movimientos' ) ) {
    table = $('#tabla-movimientos').DataTable();
}
else {
    table = $('#tabla-movimientos').DataTable( {
        paging: false
    } );
}
           
           
           $("#tabla-cheques").dataTable().fnDestroy();
            if ( $.fn.dataTable.isDataTable( '#tabla-cheques' ) ) {
    table = $('#tabla-cheques').DataTable();
}
else {
    table = $('#tabla-cheques').DataTable( {
        paging: false
    } );
}
  $("#tabla-depositos").dataTable().fnDestroy();
            if ( $.fn.dataTable.isDataTable( '#tabla-depositos' ) ) {
    table = $('#tabla-depositos').DataTable();
}
else {
    table = $('#tabla-depositos').DataTable( {
        paging: false
    } );
}
$("#tabla-nc").dataTable().fnDestroy();
            if ( $.fn.dataTable.isDataTable( '#tabla-nc' ) ) {
    table = $('#tabla-nc').DataTable();
}
else {
    table = $('#tabla-nc').DataTable( {
        paging: false
    } );
}
  $("#tabla-nd").dataTable().fnDestroy();
            if ( $.fn.dataTable.isDataTable( '#tabla-nd' ) ) {
    table = $('#tabla-nd').DataTable();
}
else {
    table = $('#tabla-nd').DataTable( {
        paging: false
    } );
}
  
           
               }
     
     });     
        $(document).ready(function () {
        });
        
        
           function cargarfacturas(id, fecha_emision,documento, paguese,descripcion, numero_cheque, monto, monto_cheque,numero_comprobante,tipo,debe,haber,conciliacion_id,asociado_cheque) {
                   if (monto=='' || monto=='null'){
                    monto=0;
                   }
                   var tip=0;
                    var t = $('#tabla-movimientos').DataTable();
                    var tc = $('#tabla-cheques').DataTable();
                    var td = $('#tabla-depositos').DataTable();
                    var tnc = $('#tabla-nc').DataTable();
                    var tnd = $('#tabla-nd').DataTable();
                     
                 var factura =
                        '<tr>' +
                        '<td name="fecha">' + fecha_emision+ '</td>' +
                        '<td name="documento">' + documento+ '</td>' +
                        '<td name="paguese">' + paguese + '</td>' +
                        '<td name="numentero_comprob">' + numero_comprobante+ '</td>' +
                        '<td align="right" name="descripion">' + descripcion + '</td>' +
                        '<td align="right" name="numero_cheque">' + numero_cheque + '</td>';
                        if (tipo=='1'){
                   factura +=  '<td align="right" name="monto">' + monto_cheque + '</td>';
                        }else{
                            if (tipo=='2'){
                                if (asociado_cheque){
                                                                    factura +=  '<td align="right" name="monto">' + monto + '</td>';

                                    }else{
                                                                        factura +=  '<td align="right" name="monto">' + haber + '</td>';

                                    }
                                     }else{
                                         
                                              if (tipo=='4' || tipo=='3'){
                                                factura +=  '<td align="right" name="monto">' + debe + '</td>';
                                                
                                                }else{
                                                    
                                                    
                                                    factura +=  '<td align="right" name="monto">' + monto + '</td>';
                                                }
                                     }
                                         
                        }
                     factura +='<td><input type="hidden" value="' + id + '" name="id">'
                     if (conciliacion_id){
                   factura +=  '';
                        }else{
                          factura +='<input value="' + id + '" type="checkbox" id="checkbox-movimiento' + id + '" onclick="seleccionar('+id+','+tip+');">'
                   
                        }
                     
                     factura +='</td>' +
                        '</tr>';
                
                if (tipo=='1'){
                     var cheque =
                        '<tr>' +
                        '<td name="fecha">' + fecha_emision+ '</td>' +
                        '<td name="documento">' + documento+ '</td>' +
                        '<td name="paguese">' + paguese + '</td>' +
                        '<td name="numentero_comprob">' + numero_comprobante+ '</td>' +
                        '<td align="right" name="descripion">' + descripcion + '</td>' +
                        '<td align="right" name="numero_cheque">' + numero_cheque + '</td>' +
                        '<td align="right" name="monto">' + monto_cheque + '</td>' +
                        '<td><input type="hidden" value="' + id + '" name="id">';
                        if (conciliacion_id){}else{
                        cheque +='<input value="' + id + '" type="checkbox" id="checkbox-cheque' + id + '" onclick="seleccionar('+id+','+tipo+');">';
                        }
                        
                        
                        cheque +='</td>' +'</tr>';
                        
                        tc.row.add($(cheque)).draw();
                }
                if (tipo=='2'){
                    
                     var nd =
                        '<tr>' +
                        '<td name="fecha">' + fecha_emision+ '</td>' +
                        '<td name="documento">' + documento+ '</td>' +
                        '<td name="paguese">' + paguese + '</td>' +
                        '<td name="numentero_comprob">' + numero_comprobante+ '</td>' +
                        '<td align="right" name="descripion">' + descripcion + '</td>' ;
                        //'<td align="right" name="numero_cheque">' + numero_cheque + '</td>' +
                        if (asociado_cheque){
                                                                    nd +=  '<td align="right" name="monto">' + monto + '</td>';

                                    }else{
                                                                        nd +=  '<td align="right" name="monto">' + haber + '</td>';

                                    }
                        //'<td align="right" name="monto">' + haber + '</td>' +
                         nd +='<td><input type="hidden" value="' + id + '" name="id">';
                        if (conciliacion_id){}else{
                        nd +='<input value="' + id + '" type="checkbox" id="checkbox-nd' + id + '" onclick="seleccionar('+id+','+tipo+');">';
                        }
                        nd +='</td>';
                        nd +='</tr>';
                        tnd.row.add($(nd)).draw();
                }
                 if (tipo=='3'){
                    tip='nc';
                     var nc =
                        '<tr>' +
                        '<td name="fecha">' + fecha_emision+ '</td>' +
                        '<td name="documento">' + documento+ '</td>' +
                        '<td name="paguese">' + paguese + '</td>' +
                        '<td name="numentero_comprob">' + numero_comprobante+ '</td>' +
                        '<td align="right" name="descripion">' + descripcion + '</td>' +
                        //'<td align="right" name="numero_cheque">' + numero_cheque + '</td>' +
                        '<td align="right" name="monto">' + debe + '</td>' +
                        '<td><input type="hidden" value="' + id + '" name="id">';
                        if (conciliacion_id){}else{
                        nc +='<input value="' + id + '" type="checkbox" id="checkbox-nc' + id + '" onclick="seleccionar('+id+','+tipo+');">';
                        }
                        nc +='</td>';
                        nc +='</tr>';
                        tnc.row.add($(nc)).draw();
                }
                
                
                 if (tipo=='4'){
                     var deposito =
                        '<tr>' +
                        '<td name="fecha">' + fecha_emision+ '</td>' +
                        '<td name="documento">' + documento+ '</td>' +
                        '<td name="paguese">' + paguese + '</td>' +
                        '<td name="numentero_comprob">' + numero_comprobante+ '</td>' +
                        '<td align="right" name="descripion">' + descripcion + '</td>' +
                        //'<td align="right" name="numero_cheque">' + numero_cheque + '</td>' +
                        '<td align="right" name="monto">' + debe + '</td>' +
                        '<td><input type="hidden" value="' + id + '" name="id">';
                        if (conciliacion_id){}else{
                        deposito +='<input value="' + id + '" type="checkbox" id="checkbox-deposito' + id + '" onclick="seleccionar('+id+','+tipo+');">';
                        }
                        deposito +='</td></tr>';
                        td.row.add($(deposito)).draw();
                }
           
                           
                           
                           t.row.add($(factura)).draw();
                           
                           
                           
                           
                           //$('#tabla-movimientos tbody').append(factura);
                           //$('#tabla-cheques tbody').append(cheque);
                           // $('#tabla-depositos tbody').append(deposito);
                           // $('#tabla-nc tbody').append(nc);
                           //  $('#tabla-nd tbody').append(nd);
           
            }
            //numero_asiento++;
            
        
function seleccionar_check(){
    $('input[type=checkbox]').click(function() {
                var id =$(this).val();
                var valor=$('#checkbox-movimiento'+id).val();
                if($(this).is(':checked')) {
                   // alert(valor);
                    actualizar_monto_movimiento();
                   
                       // actualizar_monto();
                } else {
                   // $("#abono"+id).prop("readonly",true);
                    actualizar_monto_movimiento();
                }
            });
}
       function actualizar_monto_movimiento(){
        var total=0;
        var total_cheques=0;
        var total_depositos=0;
        var total_nd=0;
        var total_nc=0;
        var id_total=0;
        var id_cheque=0;
        var total_m_nc=0;
        var total_c_nc=0;
        var total_d_nc=0;
        var total_nd_nc=0;
        var total_nc_nc=0;
        
         var cont_m_nc=0;
        var cont_c_nc=0;
        var cont_d_nc=0;
        var cont_nd_nc=0;
        var cont_nc_nc=0;
        
         var cont_m=0;
        var cont_c=0;
        var cont_d=0;
        var cont_nd=0;
        var cont_nc=0;
        
              $('#tabla-movimientos tbody tr').each(function () {
                    var row = $(this).closest('tr');
                    var id = $('input[name="id"]', row).val();
                    var monto=$('td[name="monto"]', row).text();
                    //var check= $('input[name="checkbox-movimiento"]', row).val();
                    
                   // alert(id);
                    if( $('#checkbox-movimiento'+id).is(':checked') ) {
                        //alert("selecionado");
                        id_total=id;
                         total=parseFloat(total)+parseFloat(monto);
                         cont_m=parseFloat(cont_m)+1;
                        }else{
                            cont_m_nc=parseFloat(cont_m_nc)+1;
                            total_m_nc=parseFloat(total_m_nc)+parseFloat(monto);
                        }
             
              
            });
              
                            $('#tabla-cheques tbody tr').each(function () {
                    var row = $(this).closest('tr');
                    var id = $('input[name="id"]', row).val();
                    var monto=$('td[name="monto"]', row).text();
                    //var check= $('input[name="checkbox-movimiento"]', row).val();
                   
                    
                    //alert(id);
                    if( $('#checkbox-cheque'+id).is(':checked') ) {
                       // alert(id);
                         total_cheques=parseFloat(total_cheques)+parseFloat(monto);
                          cont_c=parseFloat(cont_c)+1;
                        }else{
                         cont_c_nc=parseFloat(cont_c_nc)+1;
                            total_c_nc=parseFloat(total_c_nc)+parseFloat(monto);
                        }
             
              
            });
            $('#tabla-depositos tbody tr').each(function () {
                    var row = $(this).closest('tr');
                    var id = $('input[name="id"]', row).val();
                    var monto=$('td[name="monto"]', row).text();
                    //var check= $('input[name="checkbox-movimiento"]', row).val();
                    
                   // alert(id);
                    if( $('#checkbox-deposito'+id).is(':checked') ) {
                        //alert("selecionado");
                         total_depositos=parseFloat(total_depositos)+parseFloat(monto);
                          cont_d=parseFloat(cont_d)+1;
                        }else{
                                cont_d_nc=parseFloat(cont_d_nc)+1;
                            total_d_nc=parseFloat(total_d_nc)+parseFloat(monto);
                      
                            
                        }
             
              
            });
                          $('#tabla-nd tbody tr').each(function () {
                    var row = $(this).closest('tr');
                    var id = $('input[name="id"]', row).val();
                    var monto=$('td[name="monto"]', row).text();
                    //var check= $('input[name="checkbox-movimiento"]', row).val();
                    
                   // alert(id);
                    if( $('#checkbox-nd'+id).is(':checked') ) {
                        //alert("selecionado");
                         total_nd=parseFloat(total_nd)+parseFloat(monto);
                         cont_nd=parseFloat(cont_nd)+1;
                        }else{
                               cont_nd_nc=parseFloat(cont_nd_nc)+1;
                            total_nd_nc=parseFloat(total_nd_nc)+parseFloat(monto);
                      
                            
                        }
             
              
            });
               $('#tabla-nc tbody tr').each(function () {
                    var row = $(this).closest('tr');
                    var id = $('input[name="id"]', row).val();
                    var monto=$('td[name="monto"]', row).text();
                    //var check= $('input[name="checkbox-movimiento"]', row).val();
                    
                   // alert(id);
                    if( $('#checkbox-nc'+id).is(':checked') ) {
                        //alert("selecionado");
                         total_nc=parseFloat(total_nc)+parseFloat(monto);
                         cont_nc=parseFloat(cont_nc)+1;
                        }else{
                              cont_nc_nc=parseFloat(cont_nc_nc)+1;
                            total_nc_nc=parseFloat(total_nc_nc)+parseFloat(monto);
                      
                            
                        }
             
              
            });
            $('#total').val(total);
            $('#total_cheques').val(total_cheques);
            $('#total_depositos').val(total_depositos);
            $('#total_nc').val(total_nc);
            $('#total_nd').val(total_nd);
            
             $('#montoc_c').val(parseFloat(total_cheques).toFixed(2));
            $('#montoc_d').val(parseFloat(total_depositos).toFixed(2));
            $('#montoc_nc').val(parseFloat(total_nc).toFixed(2));
            $('#montoc_nd').val(parseFloat(total_nd).toFixed(2));
            $('#montoc_m').val(parseFloat(total).toFixed(2));
            
             $('#totalc_c').val(cont_c);
            $('#totalc_d').val(cont_d);
            $('#totalc_nc').val(cont_nc);
            $('#totalc_nd').val(cont_nd);
            $('#totalc_m').val(cont_m);
            
            
            
             $('#montonc_c').val(parseFloat(total_c_nc).toFixed(2));
            $('#montonc_d').val(parseFloat(total_d_nc).toFixed(2));
            $('#montonc_nc').val(parseFloat(total_nc_nc).toFixed(2));
            $('#montonc_nd').val(parseFloat(total_nd_nc).toFixed(2));
            $('#montonc_m').val(parseFloat(total_m_nc).toFixed(2));
            
             $('#totalnc_c').val(cont_c_nc);
            $('#totalnc_d').val(cont_d_nc);
            $('#totalnc_nc').val(cont_nc_nc);
            $('#totalnc_nd').val(cont_nd_nc);
            $('#totalnc_m').val(cont_m_nc);
            
//$('td[name="facturas-total"]').text(total.toFixed(2));
        }
        
       function get_array_movimientos() {
            var facturas = [];
            $('#tabla-movimientos tbody tr').each(function () {
                var row = $(this).closest('tr');
                var id = $('input[name="id"]', row).val();
                var monto=$('td[name="monto"]', row).text();
                 var check =false;
                if( $('#checkbox-movimiento'+id).attr('checked') ) {
                        check=true;
                }
                var factura = {"check": check, "id": id, "monto": monto};
                facturas.push(factura);
            });
            return facturas;
        }
   
       
           $('#formulario').submit(function (event) {
            var facturas = JSON.stringify(get_array_movimientos());
            var total=$('#total').val();
            
            var data = $(this).serialize() +'&arreglo_facturas=' + facturas;
        
         // alert(facturas);
            //console.log(data);
            event.preventDefault();
                add_div();
            $.ajax({
                type: "POST",
                url: "{% url 'conciliaciones-crear' %}",
                data: data,
                success: function (response) {
                    //alert(response);
                    alert("Conciliacion ingresado");
                   document.location.href = '/bancos/conciliaciones/';
                },
                error: function (response) {
                    console.log(response);
                }
            });
          
            //event.preventDefault();
        });
function add_div() {
            var div_externo = $('<div id="div-consultando" style="width: 100%; height: 100%; background-color: #191a1b; position: fixed; top: 0; right: 0; bottom: 0; left: 0; z-index: 1050; opacity: 0.8">');
            var div_interno = $('<div class="progress progress-striped active" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, 50%); width: 50%">');
            var progress = $('<div class="progress-bar progress-bar-inverse" style="width: 100%">Guardando...</div>');
            div_interno.append(progress);
            div_externo.append(div_interno);
            div_externo.appendTo($('body'));
        }
        
        
function seleccionar(id,tipo){
    //alert(tipo);
    if (tipo=='0'){
        if( $('#checkbox-movimiento'+id).is(':checked') ) {
           $('#checkbox-cheque'+id).prop("checked", true);
           $('#checkbox-deposito'+id).prop("checked", true);
           $('#checkbox-nd'+id).prop("checked", true);
           $('#checkbox-deposito'+id).prop("checked", true);
           $('#checkbox-nc'+id).prop("checked", true);
        }else{
            $('#checkbox-cheque'+id).prop("checked", false);
           $('#checkbox-deposito'+id).prop("checked", false);
           $('#checkbox-nd'+id).prop("checked", false);
           $('#checkbox-deposito'+id).prop("checked", false);
           $('#checkbox-nc'+id).prop("checked", false);
            
        }
   
}
    if (tipo=='1'){
        if( $('#checkbox-cheque'+id).is(':checked') ) {
           $('#checkbox-movimiento'+id).prop("checked", true);
           $('#checkbox-deposito'+id).prop("checked", true);
           $('#checkbox-nd'+id).prop("checked", true);
           $('#checkbox-deposito'+id).prop("checked", true);
           $('#checkbox-nc'+id).prop("checked", true);
        }else{
            $('#checkbox-movimiento'+id).prop("checked", false);
           $('#checkbox-deposito'+id).prop("checked", false);
           $('#checkbox-nd'+id).prop("checked", false);
           $('#checkbox-deposito'+id).prop("checked", false);
           $('#checkbox-nc'+id).prop("checked", false);
            
        }
    }
           if (tipo=='2'){
        if( $('#checkbox-nd'+id).is(':checked') ) {
           $('#checkbox-movimiento'+id).prop("checked", true);
           $('#checkbox-deposito'+id).prop("checked", true);
           $('#checkbox-cheque'+id).prop("checked", true);
           $('#checkbox-deposito'+id).prop("checked", true);
           $('#checkbox-nc'+id).prop("checked", true);
        }else{
            $('#checkbox-movimiento'+id).prop("checked", false);
           $('#checkbox-deposito'+id).prop("checked", false);
           $('#checkbox-cheque'+id).prop("checked", false);
           $('#checkbox-deposito'+id).prop("checked", false);
           $('#checkbox-nc'+id).prop("checked", false);
            
        }
           } 
             if (tipo=='3'){
        if( $('#checkbox-nc'+id).is(':checked') ) {
           $('#checkbox-movimiento'+id).prop("checked", true);
           $('#checkbox-deposito'+id).prop("checked", true);
           $('#checkbox-cheque'+id).prop("checked", true);
           $('#checkbox-deposito'+id).prop("checked", true);
           $('#checkbox-nd'+id).prop("checked", true);
        }else{
            $('#checkbox-movimiento'+id).prop("checked", false);
           $('#checkbox-deposito'+id).prop("checked", false);
           $('#checkbox-cheque'+id).prop("checked", false);
           $('#checkbox-deposito'+id).prop("checked", false);
           $('#checkbox-nd'+id).prop("checked", false);
            
        }
        }
             if (tipo=='4'){
        if( $('#checkbox-deposito'+id).is(':checked') ) {
           $('#checkbox-movimiento'+id).prop("checked", true);
           $('#checkbox-deposito'+id).prop("checked", true);
           $('#checkbox-cheque'+id).prop("checked", true);
           $('#checkbox-nd'+id).prop("checked", true);
           $('#checkbox-nc'+id).prop("checked", true);
        }else{
            $('#checkbox-movimiento'+id).prop("checked", false);
           $('#checkbox-deposito'+id).prop("checked", false);
           $('#checkbox-cheque'+id).prop("checked", false);
           $('#checkbox-nd'+id).prop("checked", false);
           $('#checkbox-nc'+id).prop("checked", false);
            
        }
   
}
}
    </script>
{% endblock %}