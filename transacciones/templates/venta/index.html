{% extends "login/base-list.html" %}
{% load extra_filters %}
{% load staticfiles %}

{% block css %}
    {{ block.super }}
{% endblock %}

{% block content %}
    <!-- begin col-12 -->
    <div class="col-md-12">
        <!-- begin panel -->
        <div class="panel panel-inverse">
            <div class="panel-heading">
                <div class="panel-heading-btn">
                    <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-default" data-click="panel-expand">
                        <i class="fa fa-expand"></i>
                    </a>
                    <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-warning" data-click="panel-collapse">
                        <i class="fa fa-minus"></i>
                    </a>
                </div>
                <h4 class="panel-title">FACTURA VENTAS (CLIENTES)</h4>
				 {% csrf_token %}
            </div>
            <div class="panel-body">
                <a href="{% url 'documento-venta-nuevo' %}" class="btn btn-sm btn-success">
                    <i class="fa fa-plus m-r-5"></i>
                    Ingresar Factura
                </a>
                <div class="table-responsive">
					                        

                    <table id="data-venta" class="table table-striped table-bordered">
                        <thead>
                            <tr>
                                <th>FECHA</th>
                                <th>CLIENTE</th>
                                <th>PUNTO DE VENTA</th>
                                <th>FACTURA</th>
                                <th>BASE IVA</th>
                                <th>IVA</th>
                                <th>TOTAL</th>
								 <th>DESCRIPCION</th>
								 <th>ASIENTO</th>
								 <th>ESTADO</th>
                                <th width="70" ></th>
                            </tr>
                        </thead>
						<tbody>
                                            </tbody>
                       <!-- <tbody>
                        {% for venta  in ventas %}
                            <tr>
                                <td>{{venta.fecha_emision | date:'Y-m-d' }}</td>
                                <td>{{venta.cliente.nombre_cliente}}</td>
                                <td>{{venta.punto_venta.nombre}}</td>
                                <td>{{venta.establecimiento}}-{{venta.punto_emision}}-{{venta.secuencial}}</td>
                                <td>{{venta.base_iva | floatformat:2 }}</td>
                                <td>{{venta.valor_iva | floatformat:2 }}</td>
                                <td>{{venta.total | floatformat:2 }}</td>
								<td>{{venta.descripcion | default_if_none:""}}</td>
								<td>{{venta.asiento.codigo_asiento | default_if_none:""}}</td>

								    <td>
                                    {% if venta.activo %}
                                    Activo
                                 {% else %}
                                Anulado
                                {% endif %}
                                </td>
                                <td>
                                 
                                    <a href="{% url 'documento-venta-factura-imprimir' venta.id %}" target="_blank">
                                        <button type="button" class="btn btn-default btn-xs" title="Imprimir factura">
                                            <i class="fa fa-print"></i>
                                        </button>
                                    </a>
									   <a href="{% url 'documento-venta-delete-pk' venta.id %}" onclick="return confirm('¿Está seguro de borrar esta factura?')">
                                        <button type="button" class="btn btn-danger btn-xs">
                                            <i class=" glyphicon glyphicon-trash icon-white"></i>
                                        </button>
                                    </a>
									   
									   <a href="{% url 'factura-imprimir-pdf' venta.id %}">
										 <button type="button" class="btn btn-default btn-xs" title="PDF factura">
                                            <i class="fa fa-print">pdf</i>
                                        </button>

										 </a>
                                    
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>-->
                    
					
					
					
					</table>
                </div>
            </div>
        </div>
        <!-- end panel -->
        <!-- #modal-dialog -->
    </div>
    <!-- end col-12 -->
{% endblock %}

{% block javascript %}
    {{ block.super }}
<script>
	$(document).ready(function () {
		 $('#data-venta').DataTable({
                 "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                    dom: 'Blfrtip',
                    buttons: [
                        'copy', 'csv', 'excel', 'pdf', 'print'
                    ]
                  
            });
		 $('#data-venta tbody').html("");
		 var t = $('#data-venta').DataTable();
                    $.ajax({
                    type: "POST",
                    url: "{% url 'documento-venta-api' %}",
                    data: {
                        csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val()
                    },
                    success: function(response) {
                        
                            
                          
                        for (var i = 0; i < response.length; i++) {
							
                        var factura =
                        '<tr>' +
                        '<td>' + response[i][1]+ '</td>' +
                        '<td>' + response[i][2]+ '</td>' +
                        '<td>' + response[i][6] + '</td>' +
                        '<td>' + response[i][3]+ '-' + response[i][4]+ '-' + response[i][5]+ '</td>' +
                        '<td>' + response[i][7] + '</td>' +
						'<td>' + response[i][8] + '</td>' +
						'<td>' + response[i][9] + '</td>' +
						'<td>' + response[i][10] + '</td>' +
                        '<td>' + response[i][11] + '</td>';
                        if (response[i][12]== true){
                    factura +='<td>Activo</td>';
                   
                        }else{
							factura +='<td>Anulado</td>';
						}
                     
                        factura +='<td>';
						if (response[i][12]== true ){
							if (response[i][14]){
								
							}else{
								 factura +='<a href="/transacciones/documento/venta/factura/'+response[i][0]+'/imprimir" target="_blank"><button type="button" class="btn btn-default btn-xs" title="Imprimir factura"><i class="fa fa-print"></i></button></a>';
								factura +='<a href="/transacciones/documento/'+response[i][0]+'/eliminar/" onclick="return confirm("¿Está seguro de borrar esta factura?")"><button type="button" class="btn btn-danger btn-xs"><i class=" glyphicon glyphicon-trash icon-white"></i></button></a>';
							if (response[i][15]){
								factura +='<a href="/transacciones/consultar_datos_facturacion_electronica/'+response[i][0]+'/" target="_blank"><button type="button" class="btn btn-default btn-xs" title="Imprimir factura"><i class="fa fa-eye"></i>Ver faturacion electro.</button></a>';
							}else{
								yeart=response[i][1].split('/');
								if (yeart[0] == '2017'){
									
								}else{
										factura +='<a href="#" onclick="mostrarFacturacionElectronica('+response[i][0]+')"><button type="button" class="btn btn-default btn-xs"><i class="fa fa-eye">Fct. electronica</i></button></a>'
								}
                       
							
							}
							}
                           //factura +='<a href="/transacciones/documento/venta/imprimirArchivoPdf/'+response[i][0]+'/"><button type="button" class="btn btn-default btn-xs" title="PDF factura"><i class="fa fa-print">pdf</i>';
                        }else{
							factura +='<a href="/transacciones/documento/venta/factura/'+response[i][0]+'/imprimir" target="_blank"><button type="button" class="btn btn-default btn-xs" title="Imprimir factura"><i class="fa fa-print"></i></button></a>';
							//factura +='<a href="/transacciones/documento/venta/imprimirArchivoPdf/'+response[i][0]+'/"><button type="button" class="btn btn-default btn-xs" title="PDF factura"><i class="fa fa-print">pdf</i>';
                       
						}
						factura +='<a href="/transacciones/documento/venta/factura/'+response[i][0]+'/consultar"><button type="button" class="btn btn-default btn-xs"><i class="fa fa-eye"></i></button></a>'
						
						factura +='</td>';
                         factura +='</tr>';
						t.row.add($(factura)).draw();

                        }
						
                        
                    },
                    error: function(response) {
                        //alert("El banco no tiene movimientos asociados .");
                    }
                });
   
            
          
         
        });
	
	
	 function mostrarFacturacionElectronica(id){
      
     
     var parametros = {
                'id': id,
                'csrfmiddlewaretoken': '{{ csrf_token }}'

            }
            $.ajax({
                    url: "/transacciones/consultar_facturacion_electronica/",
                    type: "POST",
                    async: true,
                    data: parametros,
                    success: function(data){
                        alert(data);
						document.location.href = '/transacciones/documento/venta';
                         

                    },
                    complete: function(){
                    }
                });





    }
    
    
         
</script>


	{% if form.errors or form_mode == "update" %}
	<script type="text/javascript">
        $(document).ready(function () {
            $('#data-table').DataTable();
        });
	</script>
	{% endif %}

{% endblock %}




