var map;var marker;var selectedmarker;var geocoder=new google.maps.Geocoder();var resize_icon="/static/crm/img/control/resize.png";var flag_fullscreen=0;
var mapdiv;var infowindow=new google.maps.InfoWindow({content:""});function cargar_gmap(f,e,b,d){var c={zoom:15,center:new google.maps.LatLng("-2.14682994994","-79.8824501038"),mapTypeControl:true,streetViewControl:false,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},mapTypeId:google.maps.MapTypeId.ROADMAP,};
mapdiv=document.getElementById("map_canvas");map=new google.maps.Map(mapdiv,c);if(d){var g=document.createElement("div");var a=new FullscreenControl(g,map);
g.index=4;map.controls[google.maps.ControlPosition.TOP_RIGHT].push(g);if(latlogValid(f,e)){createPointToEdit(f,e);}else{createPointToEdit("-2.14682994994","-79.8824501038");
}}else{crearPuntoInfowindows(b,f,e);}}function latlogValid(b,a){if((b!=""&&b!=="None")&&(a!=""&&a!=="None")){return true;}else{return false;}}function crearPuntoInfowindows(a,c,b){if(latlogValid(c,b)){c=c.replace(",",".");
b=b.replace(",",".");marker=crearPunto(parseFloat(c),parseFloat(b));}if(a!=""&&marker){(function(d,e){google.maps.event.addListener(d,"click",function(){infowindow.setContent("<strong>"+e+"</strong>");
infowindow.open(map,d);});})(marker,a);}return marker;}function crearPunto(c,b){var a=new google.maps.LatLng(c,b);marker=new google.maps.Marker({animation:google.maps.Animation.DROP,map:map,position:a});
return marker;}function geocodePosition(){var e="";var f="";var g="";var d=document.getElementById("id_direccion");var c=document.getElementById("id_ciudad");
var b=document.getElementById("id_pais");if(d){direccion=d.value;}else{direccion=document.getElementById("id_direccion_factura").value;}if(c){f=c.value;
}else{f=document.getElementById("id_ciudad_factura").value;}if(b){g=b.value;}else{g=document.getElementById("id_pais_factura").value;}var a=direccion;if(f!=""){a+=", "+f;
}if(g!=""){a+=", "+g;}else{a+=", Ecuador";}geocoder.geocode({address:a},function(i,h){if(h==google.maps.GeocoderStatus.OK){map.setCenter(i[0].geometry.location);
marker.setPosition(i[0].geometry.location);fill_id_coords();}else{alert("No podemos encontrar la direcci&oacute;n, error: "+h);}});}function createPointToEdit(b,a){b=b.replace(",",".");
a=a.replace(",",".");marker=markerdraggable(b,a);marker.setMap(map);selectedmarker=marker;map.setCenter(marker.getPosition());}function markerdraggable(e,f){var c;
var d=new google.maps.LatLng(e,f);var a=new google.maps.Marker({draggable:true,animation:google.maps.Animation.DROP,position:d,map:map,});var b={};c=a;
google.maps.event.addListener(c,"dragstart",function(){selectedmarker=c;});google.maps.event.addListener(c,"dragend",function(){fill_id_coords();});markerdraggable_listener=google.maps.event.addListener(map,"click",function(){fill_id_coords();
});return c;}function fill_id_coords(){lon=selectedmarker.getPosition().lng();lat=selectedmarker.getPosition().lat();var a=document.getElementById("id_lat_dir");
var b=document.getElementById("id_lon_dir");if(!a){a=document.getElementById("id_lat_dir_factura");}if(!b){b=document.getElementById("id_lon_dir_factura");
}a.value=lat;b.value=lon;}function FullscreenControl(a,d){a.style.padding="5px";var c=document.createElement("div");c.style.height="24px";c.style.width="24px";
c.style.backgroundColor="white";c.style.borderStyle="solid";c.style.borderWidth="1px";c.style.borderColor="#717B87";c.style.textAlign="center";c.style.cursor="pointer";
c.title="Expander Mapa";a.appendChild(c);var b=document.createElement("div");b.style.paddingTop="2px";b.style.paddingLeft="3px";b.style.paddingRight="3px";
b.innerHTML='<img src="'+resize_icon+'"  />';c.appendChild(b);google.maps.event.addDomListener(c,"click",function(){fullscreenMap();});}function fullscreenMap(){if(flag_fullscreen===0){mapdiv.style.position="fixed";
mapdiv.style.top="0";mapdiv.style.left="0";mapdiv.style.width="100%";mapdiv.style.height="100%";mapdiv.style.zIndex="999";flag_fullscreen=1;}else{mapdiv.style.position="relative";
mapdiv.style.top="0";mapdiv.style.left="0";mapdiv.style.width="100%";mapdiv.style.height="178px";mapdiv.style.zIndex="0";flag_fullscreen=0;}google.maps.event.trigger(map,"resize");
}