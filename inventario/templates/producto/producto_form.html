{% extends "login/base_nuevo.html" %}
{% load staticfiles %}

{# Load the tag library #}
{% load bootstrap3 %}

{# Load CSS and JavaScript #}
{% bootstrap_javascript %}

{# Display django.contrib.messages as Bootstrap alerts #}
{% bootstrap_messages %}

{% block css %}
{{ block.super }}
    <!-- ================== BEGIN PAGE LEVEL STYLE ================== -->
    <link href="{% static 'color_admin/assets/plugins/bootstrap-wizard/css/bwizard.min.css' %}" rel="stylesheet" />
    <!-- ================== END PAGE LEVEL STYLE ================== -->
{% endblock %}

{% block breadcrumb %}Sucursal {{ sucursal.nombre }}{% endblock %}
{% block section_title %}Producto{% endblock %}
{% block section_subtitle %}Por favor diligencie el siguiente formulario{% endblock %}
{% block content %}

            <!-- begin row -->
           <style>
       .panel-border{border: 1px solid #ddd !important}
       .form-ajust .form-group{margin-bottom: 0px !important}
      input[type="text"],select,input[type="number"]
      {

    border: 1px solid #ccd0d4;
    border-radius: 3px;
    box-shadow: none;
    font-size: 12px;
    display: block;
    width: 100%;
    height: 34px;
    padding: 6px 12px;
    line-height: 1.42857143;
    color: #555;
    background-color: #fff;
    background-image: none;
       }



    </style>

  <div class="row">
                <!-- begin col-6 -->
      <div class="col-md-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                         <form method="post" data-parsley-validate="true" name="form-wizard" enctype="multipart/form-data"> {% csrf_token %}

                        <h3 class="panel-title">Actualizar Producto</h3>
                    </div>
                    <div class="panel-body">
                        <div class="col-md-9">
                            <div>

                                <!-- Nav tabs -->
                                <ul class="nav nav-tabs" role="tablist">
                                  <li role="presentation" class="active"><a href="#principales" aria-controls="principales" role="tab" data-toggle="tab">Principales</a></li>
                                  <li role="presentation"><a href="#movimientos" aria-controls="movimientos" role="tab" data-toggle="tab">Movimientos</a></li>
                                  <li role="presentation"><a href="#presupuesto" aria-controls="presupuesto" role="tab" data-toggle="tab">Presupuesto</a></li>
                                  <li role="presentation"><a href="#costo" aria-controls="costo" role="tab" data-toggle="tab">Costos y Precios</a></li>
                                  <li role="presentation"><a href="#codigo" aria-controls="codigo" role="tab" data-toggle="tab">C&oacute;digo de Barras</a></li>
                                  <li role="presentation"><a href="#foto" aria-controls="foto" role="tab" data-toggle="tab">Foto</a></li>
                                </ul>

                                <!-- Tab panes -->
                                <div class="tab-content">
                                    <div role="tabpanel" class="tab-pane fade in active" id="principales">
                                        <div class="row">

                                            <div class="panel panel-default panel-border">
                                                <div class="panel-heading">Id del Registro</div>
                                                <div class="panel-body">

                                                    <div class="col-md-4">
                                                      <label for="exampleInputName2">C&oacute;digo</label>
                                                        {{ producto_form.codigo_producto }}
                                                    </div>
                                                    <div class="col-md-8">
                                                      <label for="exampleInputEmail2">Nombre</label>
                                                      {{ producto_form.descripcion_producto }}
                                                    </div>
                                                     <div class="col-md-12">
                                                      <label for="exampleInputEmail2">Descripcion Interna</label>
                                                      {{ producto_form.descripcion_interna }}
                                                    </div>

                                                </div>
                                            </div>

                                        </div>
                                        <div class="row">
                                            <div class="col-md-7">
                                                <div class="row">
                                                    <div class="panel panel-default panel-border">
                                                            <div class="panel-heading">Agrupaci&oacute;n</div>
                                                            <div class="panel-body">

                                                                <div class="form-horizontal">
                                                                    <div class="form-group">
                                                                         <label for="inputEmail3" class="col-sm-3 control-label">Tipo de producto</label>

                                                                         <div class="col-sm-6">
                                                                            {{ producto_form.tipo_producto }}
                                                                         </div>
                                                                     </div>
                                                                    <div class="form-group">
                                                                         <label for="inputEmail3" class="col-sm-3 control-label">L&iacute;nea</label>

                                                                         <div class="col-sm-6">
                                                                            {{ producto_form.linea }}
                                                                         </div>
                                                                     </div>
                                                                    <div class="form-group">
                                                                         <label for="inputEmail3" class="col-sm-3 control-label">Grupo</label>

                                                                         <div class="col-sm-6">
                                                                            {{ producto_form.categoria }}
                                                                         </div>
                                                                     </div>
                                                                    <div class="form-group">
                                                                         <label for="inputEmail3" class="col-sm-3 control-label">Subgrupo</label>

                                                                         <div class="col-sm-6">
                                                                           {{ producto_form.sub_categoria }}
                                                                         </div>
                                                                    </div>

                                                                </div>


                                                            </div>
                                                    </div>
                                                </div>
                                                <div class="row">

                                                </div>
                                                <div class="row">
                                                    <div class="panel panel-default panel-border">
                                                            <div class="panel-heading">Datos adicionales</div>
                                                            <div class="panel-body">

                                                               <div class="form-horizontal">
                                                                    <div class="form-group text-center">

                                                                          <label class="checkbox-inline">
                                                                            {{ producto_form.activo }}Bloquear Producto
                                                                          </label>
                                                                     </div>


                                                                </div>
                                                                <div class="col-md-6">
                                                <label for="inputEmail3" >Codigo Produccion</label>
                                               {{ producto_form.codigo_produccion }}
                                            </div>

                                            </div>
                                            </div>
                                            </div>
                                            </div>
                                            <div class="col-md-5">
                                            <div class="form-horizontal form-ajust">
                                               <div class="form-group">
                                                    <label for="inputEmail3" class="col-sm-4 control-label">Unidad</label>
                                                    <div class="col-sm-8">
                                                      {{ producto_form.unidad }}
                                                    </div>
                                                </div>
                                             <!--   <div class="form-group">
                                                    <label for="inputEmail3" class="col-sm-4 control-label">Medida de peso</label>
                                                    <div class="col-sm-8">
                                                      {{ producto_form.medida_peso }}
                                                    </div>
                                                </div>
                                               <div class="form-group">
                                                    <label for="inputEmail3" class="col-sm-4 control-label">Peso</label>
                                                    <div class="col-sm-8">
                                                      {{ producto_form.peso }}
                                                    </div>
                                                </div> -->
                                               <div class="form-group">
                                                    <label for="inputEmail3" class="col-sm-4 control-label">Ultimo Costo</label>
                                                   <fieldset class="col-sm-8" disabled>
                                                       {{ producto_form.costo }}
                                                   </fieldset>
                                               </div>

                                               <div class="form-group" disabled >
                                                   <label for="inputEmail3" class="col-sm-4 control-label">Costo Promedio</label>
                                                   <fieldset class="col-sm-8" disabled>
                                                       {{ producto_form.costo_promedio }}
                                                   </fieldset>
                                               </div>
                                               <div class="form-group">
                                                    <label for="inputEmail3" class="col-sm-4 control-label">Precio de Compra</label>
                                                    <div class="col-sm-8">
                                                     <div class="input-group" > <span class="input-group-addon">$</span> {{ producto_form.precio1}}</div>
                                                    </div>
                                               </div>
                                               <div class="form-group">
                                                    <label for="inputEmail3" class="col-sm-4 control-label">Precio 2</label>
                                                    <div class="col-sm-8">
                                                     <div class="input-group"> <span class="input-group-addon">$</span>{{ producto_form.precio2 }}</div>
                                                    </div>
                                                </div>
                                               <div class="form-group">
                                                    <label for="inputEmail3" class="col-sm-4 control-label">Precio 3</label>
                                                    <div class="col-sm-8">
                                                    <div class="input-group"> <span class="input-group-addon">$</span> {{ producto_form.precio3 }}</div>
                                                     </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="inputEmail3" class="col-sm-4 control-label">Stock maximo</label>
                                                    <div class="col-sm-8">
                                                    {% bootstrap_field producto_form.cant_maxima show_label=False %}
                                                    </div>
                                                </div>
                                               <div class="form-group">
                                                    <label for="inputEmail3" class="col-sm-4 control-label">Stock minimo</label>
                                                    <div class="col-sm-8">
                                                    {{ producto_form.cant_minimia }}
                                                    </div>
                                                </div>
                                               <div class="form-group">
                                                    <label for="inputEmail3" class="col-sm-4 control-label">UAT</label>
                                                    <div class="col-sm-8">
                                                      <input type="text" class="form-control" id="inputEmail3" placeholder="0.00">
                                                    </div>
                                                </div>
                                               <div class="form-group">
                                                    <label for="inputEmail3" class="col-sm-4 control-label">Precio compra max.</label>
                                                    <div class="col-sm-8">
                                                    <div class="input-group"> <span class="input-group-addon">$</span> {{ producto_form.precio_de_compra_max }}</div>

                                                    </div>
                                                </div>
                                                <div class="form-group text-right ">
                                                    <label class="checkbox">
                                                      {{ producto_form.acepta_iva }} Producto con IVA
                                                    </label>

                                               </div>

                                            </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="inputEmail3" >Observaci&oacute;n</label>
                                                    <div>
                                                       {{ producto_form.notas }}
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="inputEmail3" >Usuario y Fecha de Edici&oacute;n</label>
                                                <table class="table table-bordered">
                                                    <tr>
                                                        <th>Creaci&oacute;n</th>
                                                        <td>{{ producto_form.created_by.value}}  </td>
                                                        <td>{{ producto_form.created_at.value }}</td>
                                                    </tr>
                                                    <tr>
                                                        <th>Actualizado</th>
                                                        <td>{{ producto_form.updated_by.value}}</td>
                                                        <td>{{ producto_form.updated_at.value}}</td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </div>

<div style="display: none"> {% bootstrap_field producto_form.created_by show_label=False %}
{% bootstrap_field producto_form.created_at show_label=False %}
{% bootstrap_field producto_form.updated_by show_label=False %}
{% bootstrap_field producto_form.updated_at show_label=False %}
</div>
                                    </div>

                                    <div role="tabpanel" class="tab-pane fade" id="movimientos">
                                           {% if kardex %}
                                        				<table id="data-table" class="table table-striped table-bordered">
									<thead>
										<tr>
											<th>Fecha</th>
											<th>Producto</th>
											<th>Bodega</th>
											<th>cantidad</th>
											<th>Descripcion</th>
                                            <th>Observacion</th>
										</tr>
									</thead>
									<tbody>
										{% for k  in kardex %}
											<tr>
												<td> {% if k.fecha_ingreso %}

												 {{ k.fecha_ingreso }}
												 {% else %}
												 {{ k.fecha_egreso }}

												 {% endif %}
												 </td>

												<td>{{ k.producto }}</td>
												<td>{{ k.bodega }}</td>
												<td>{{ k.cantidad }}</td>
												<td>{{ k.descripcion }}</td>
                                                <td>{{ k.un_doc_soporte }}</td>


											</tr >
										{% endfor %}
									</tbody>
								</table>
						{% endif %}


                                    </div>
                                    <div role="tabpanel" class="tab-pane fade" id="presupuesto">
                                        <div class="row">

                                            <div class="panel panel-default panel-border">
                                                <div class="panel-heading">Id del Registro</div>
                                                <div class="panel-body">

                                                    <div class="col-md-4">
                                                      <label for="exampleInputName2">C&oacute;digo</label>
                                                      <input type="text" class="form-control" id="codigo" placeholder="Codigo">
                                                    </div>
                                                    <div class="col-md-8">
                                                      <label for="exampleInputEmail2">Nombre</label>
                                                      <input type="text" class="form-control" id="nombre" placeholder="Ingrese el nombre del producto">
                                                    </div>


                                                </div>
                                            </div>

                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="inputEmail3" >Enero</label>
                                                    <div>
                                                      {{ presupuesto_producto_form.enero }}
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="inputEmail3" >Julio</label>
                                               {{ presupuesto_producto_form.julio}}
                                            </div>
                                        </div>

                                              <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="inputEmail3" >Febrero</label>
                                                    <div>
                                                      {{ presupuesto_producto_form.febrero }}
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="inputEmail3" >Agosto</label>
                                               {{ presupuesto_producto_form.agosto}}
                                            </div>
                                        </div>


                                           <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="inputEmail3" >Marzo</label>
                                                    <div>
                                                      {{ presupuesto_producto_form.marzo }}
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="inputEmail3" >Septiembre</label>
                                               {{ presupuesto_producto_form.septiembre}}
                                            </div>
                                        </div>

                                           <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="inputEmail3" >Abril</label>
                                                    <div>
                                                      {{ presupuesto_producto_form.abril }}
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="inputEmail3" >Octubre</label>
                                               {{ presupuesto_producto_form.octubre}}
                                            </div>
                                        </div>


   <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="inputEmail3" >Mayo</label>
                                                    <div>
                                                      {{ presupuesto_producto_form.mayo }}
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="inputEmail3" >Noviembre</label>
                                               {{ presupuesto_producto_form.noviembre}}
                                            </div>
                                        </div>

                                           <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="inputEmail3" >Junio</label>
                                                    <div>
                                                      {{ presupuesto_producto_form.junio }}
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="inputEmail3" >Diciembre</label>
                                               {{ presupuesto_producto_form.diciembre}}
                                            </div>
                                        </div>

                                    </div>
                                    <div role="tabpanel" class="tab-pane fade" id="costo">..

                                    </div>
                                    <div role="tabpanel" class="tab-pane fade" id="codigo">...</div>
                                    <div role="tabpanel" class="tab-pane fade" id="foto">
                                        <div class="row">

                                            <div class="panel panel-default panel-border">
                                                <div class="panel-heading">Foto</div>
                                                <div class="panel-body">

                                                    <div class="col-md-4">
                                                      <label for="exampleInputName2">Imagen</label>
                                                        {{ producto_form.imagen }}
                                                   </div>


                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="row">
                                <div class="col-xs-12">
                                  <a href="#" class="thumbnail">
                                  {% if producto_form.imagen.value != "" %}
                                   <img src="/media/{{ producto_form.imagen.value}}" alt="logo producto">
                                    {% else %}
                                    <img src="/media/imagenes/producto/logo-producto.svg" alt="logo producto">
                                    {% endif %}
                                  </a>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>

     <p class="text-center">

                                    <button type="submit" class="btn btn-primary btn-lg"><i class="fa fa-cog"></i> Guardar</button>
                                            <a class="default btn btn-link" href="/inventario/producto"><button type="button" class="btn btn-primary btn-lg">  Regresar</button></a>
                                        </p>
                                         {% if kits %}
<input type="hidden" name="columnas_receta" id="columnas_receta" value="{{ kits|length }}" />
{% else %}
<input type="hidden" name="columnas_receta" id="columnas_receta" value="1" />

{% endif %}
<input type="hidden" name="id_fila_cambiar" id="id_fila_cambiar" value="" />
<input type="hidden" name="product_id" id="product_id" value="{{ producto_form.producto_id.value}}" />



<!--  <p class="text-right m-b-0">
                                    <button type="submit" class="btn btn-primary"><i class="fa fa-cog"></i> Guardar</button>
                                </p>
                                <a class="default btn btn-link" href="/inventario/producto">
      <i class="fa fa-times"></i> Regresar
    </a> -->
                            </form>

{% endblock %}

{% block javascript %}
{{ block.super }}
<!-- ================== BEGIN PAGE LEVEL JS ================== -->
<script src="{% static 'color_admin/assets/plugins/parsley/dist/parsley.js' %}"></script>
<script src="{% static 'color_admin/assets/plugins/bootstrap-wizard/js/bwizard.js' %}"></script>
<!-- <script src="{% static 'color_admin/assets/js/form-wizards-validation.demo.min.js' %}"></script>
<!-- ================== END PAGE LEVEL JS ================== -->
<script>
    // $(document).ready(function() {
    //     App.init();
    //     FormWizardValidation.init();
    // });
</script>
<script>
    $(document).ready(function() {
      $('#id_codigo_producto').each(function(){
  $(this).attr('readonly','readonly');
});
       $('#id_created_by').each(function(){
  $(this).attr('readonly','readonly');
});
        $('#id_updated_by').each(function(){
  $(this).attr('readonly','readonly');
});
        $('#id_created_at').each(function(){
  $(this).attr('readonly','readonly');
});
        $('#id_updated_at').each(function(){
  $(this).attr('readonly','readonly');
});
      var codigo_producto=$('#id_codigo_producto').val();
      //alert(codigo_producto);
      if(codigo_producto==""){
         $.ajax({
                url: "/config/obtenerSecuencial/", // the endpoint
                type : "POST", // http method
                data : { id : 'producto','csrfmiddlewaretoken': '{{ csrf_token }}'},
                success:function(data){
                 $('#id_codigo_producto').val(data);

                },
                error: function(){

                },
              });
      }

$(".mask_float").maskMoney({thousands:'', decimal:'.', allowZero: true});

    });
    function mostrarProductos(data){
       $('#id_fila_cambiar').val(data);
       $(".modal").modal('toggle');
    }

    function cargarCodigoProducto(id,codigo,descripcion,medida,costo){
      var fila=$('#id_fila_cambiar').val();
         $('#id_kits'+fila).val(id);

        $('#codigo_kits'+fila).val(codigo);
         $('#nombre_kits'+fila).val(descripcion);
           $('#medida_kits'+fila).val(medida);
         $('#costo_kits'+fila).val(costo);
    }
    function actualizarCosto(data){
      var cantidad=$('#cantidad_kits'+data).val();
      var costo= $('#costo_kits'+data).val();


       var valor=parseFloat(cantidad)*parseFloat(costo);
       alert(data);
      alert(costo);
      alert(valor);
      $('#total_kits'+data).val(valor);
    }
</script>
<script type="text/javascript">
    $(document).ready(function(){
        /**
         * Funcion para añadir una nueva columna en la tabla
         */
        $("#add").click(function(){
            // Obtenemos el numero de filas (td) que tiene la primera columna
            // (tr) del id "tabla"
            var num_recetas=$('#columnas_receta').val();
            num_recetas=parseInt(num_recetas)+1;

            var tds=$("#tabla tr:first td").length;
            // Obtenemos el total de columnas (tr) del id "tabla"
            var trs=$("#tabla tr").length;
            var nuevaFila='<tr><td  class="eliminar"><a class="btn btn-danger remove_fields "><i class=" glyphicon glyphicon-trash icon-white"></i></a></td>';
                nuevaFila+='<td><input type="hidden" class="form-control" id="id_kits'+num_recetas+'" name="id_kits'+num_recetas+'"> ';
                nuevaFila+='<input type="text" class="form-control" id="codigo_kits'+num_recetas+'" name="codigo_kits'+num_recetas+'" onfocus="mostrarProductos('+num_recetas+')"></td>';
                 nuevaFila+='<td><input type="text" class="form-control" id="nombre_kits'+num_recetas+'" name="nombre_kits'+num_recetas+'"></td>';
                nuevaFila+='<td><input type="text" class="form-control" id="cantidad_kits'+num_recetas+'" name="cantidad_kits'+num_recetas+'" onkeyup="actualizarCosto('+num_recetas+')"></td>';
                nuevaFila+='<td><input type="text" class="form-control" id="medida_kits'+num_recetas+'" name="medida_kits'+num_recetas+'"></td>';
                nuevaFila+='<td><input type="text" class="form-control" id="costo_kits'+num_recetas+'" name="costo_kits'+num_recetas+'"></td>';
                nuevaFila+='<td><input type="text" class="form-control" id="total_kits'+num_recetas+'" name="total_kits'+num_recetas+'"></td>';
                nuevaFila+='</tr>';

              $('#columnas_receta').val(num_recetas);
            // for(var i=0;i<tds;i++){
            //     // añadimos las columnas
            //     nuevaFila+="<td>columna "+(i+1)+" Añadida con jquery</td>";
            // }
            // // Añadimos una columna con el numero total de columnas.
            // // Añadimos uno al total, ya que cuando cargamos los valores para la
            // // columna, todavia no esta añadida
            // nuevaFila+="<td>"+(trs+1)+" columnas";
            // nuevaFila+="</tr>";
            $("#tabla").append(nuevaFila);
        });

        /**
         * Funcion para eliminar la ultima columna de la tabla.
         * Si unicamente queda una columna, esta no sera eliminada
         */
        $("#del").click(function(){
            // Obtenemos el total de columnas (tr) del id "tabla"
            var trs=$("#tabla tr").length;
            if(trs>1)
            {
                // Eliminamos la ultima columna
                $("#tabla tr:last").remove();
            }
        });


        $(document).on("click",".eliminar",function(){
            var parent = $(this).parent();
  $(parent).remove();
          });

    });
    </script>

{% endblock %}
