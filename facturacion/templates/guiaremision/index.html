{% extends "login/base-list.html" %}
{% load extra_filters %}

{% load staticfiles %}

{% block css %}
{{ block.super }}
{% endblock %}

{% block section_title %}Guia Remision{% endblock %}
{% block section_subtitle %}
<br />
 <div class="email-btn-row hidden-xs">
                        <a href="{% url "guiaremision-create" %}" class="btn btn-sm btn-success"><i class="fa fa-plus m-r-5"></i> Nueva Guia</a>
                    </div>

                    {% endblock %}

{% block content %}
				<!-- begin col-12 -->
				<div class="col-md-12">
					<!-- begin panel -->
					<div class="panel panel-inverse">
						<div class="panel-heading">
							<div class="panel-heading-btn">
								<a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-default" data-click="panel-expand"><i class="fa fa-expand"></i></a>
								<a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-warning" data-click="panel-collapse"><i class="fa fa-minus"></i></a>
							</div>
							<h4 class="panel-title">Guias de Remision</h4>
						</div>
						<div class="panel-body">
							<div class="table-responsive">
								<table id="data-table" class="table table-striped table-bordered">
									<thead>
										<tr>
											<th>Nro. Guia</th>
											<th>Cliente</th>
											<th>Chofer</th>
											<th>Fecha</th>
											<th>Motivo del Traslado</th>
											<th>Estado</th>
											<th>Accion</th>
										</tr>
									</thead>
									<tbody>
										{% for orden  in guias %}
											<tr>
												<td><a > {{ orden.nro_guia }}</a></td>
												<td>{{ orden.cliente }}</td>
												<td>{{ orden.chofer.empleado.nombre_empleado }}</td>
												<td>{{ orden.fecha_inicio }}</td>
												<td>{{ orden.tipo_guia }}</td>
												<td>{% if orden.aprobada %}
														Aprobada
												
														{% else %}
														Esperando aprobacion
														{% endif %}</td>

												
												<td>
													{% if orden.aprobada %}
														{% if orden.facturacion_eletronica %}
														{% else %}
														<a href="#" onclick="mostrarGuiaElectronica({{ orden.guia_id }})"><button type="button" class="btn btn-info btn-xs"><i class="fa fa-cog"></i> Guia Eltronica</button></a>
														{% endif %}
													{% else %}
													<a href="{% url 'guiaremision-update' orden.guia_id %}">														<button type="button" class="btn btn-info btn-xs"><i class="fa fa-cog"></i> Editar</button></a>
													{% endif %}

													<a href="{% url 'guiaremision-imprimir' orden.guia_id %}">														<button type="button" class="btn btn-info btn-xs"><i class="fa fa-cog"></i> Imprimir</button>								
</a>

												</td>
											</tr >
										{% endfor %} 
									</tbody>
								</table>
							</div>




						</div>
					</div>
					<!-- end panel -->

					<!-- #modal-dialog -->
					
				</div>
				<!-- end col-12 -->	
			
{% endblock %}

{% block javascript %}
{{ block.super }}
	<script type="text/javascript">
			
	 function mostrarGuiaElectronica(id){
      
     
     var parametros = {
                'id': id,
                'csrfmiddlewaretoken': '{{ csrf_token }}'

            }
            $.ajax({
                    url: "/facturacion/consultar_guia_electronica/",
                    type: "POST",
                    async: true,
                    data: parametros,
                    success: function(data){
                        alert(data);
	document.location.href = '/facturacion/guiaremision/';

                    },
                    complete: function(){
                    }
                });





    }
    

	function detalledeCompra(id){
          $.ajax({
                url: "/config/obtenerDetalleCompra/", // the endpoint
                type : "POST", // http method
                data : { id : id,'csrfmiddlewaretoken': '{{ csrf_token }}'}, 
                success:function(data){
                  $("#detalle").append(data);
                },
                error: function(){
                 
                },
              });
    }
	</script>
	<!-- ================== END PAGE LEVEL JS ================== -->
	{% if form.errors or form_mode == "update" %}
	<script type="text/javascript">
		$( document ).ready(function() {
		    $(".modal").modal('toggle');
		});
	
	</script>
	{% endif %}
{% endblock %}
