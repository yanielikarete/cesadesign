{% extends "login/base_nuevo.html" %}
{% load staticfiles %}

{# Load the tag library #}
{% load bootstrap3 %}

{# Load CSS and JavaScript #}
{% bootstrap_javascript %}

{# Display django.contrib.messages as Bootstrap alerts #}
{% bootstrap_messages %}

{% block css %}
{{ block.super }}
<!-- ================== BEGIN PAGE LEVEL STYLE ================== -->
<link href="{% static 'color_admin/assets/plugins/bootstrap-wizard/css/bwizard.min.css' %}" rel="stylesheet" />
<link href="{% static 'color_admin/assets/plugins/bootstrap-datepicker/css/datepicker.css'%}" rel="stylesheet" />
<link href="{% static 'color_admin/assets/plugins/bootstrap-datepicker/css/datepicker3.css'%}" rel="stylesheet" />
<!-- ================== END PAGE LEVEL STYLE ================== -->
{% endblock %}

{% block section_title %}Guia de Remision{% endblock %}
{% block section_subtitle %}Por favor diligencie el siguiente formulario{% endblock %}
{% block content %}
<style>
.panel-border{border: 1px solid #ddd !important}
.form-ajust .form-group{margin-bottom: 0px !important}
input[type="text"],select,input[type="number"]
{

  border: 1px solid #ccd0d4;
  border-radius: 3px;
  box-shadow: none;
  font-size: 12px;
  display: block;
  width: 100%;
  height: 34px;
  padding: 6px 12px;
  line-height: 1.42857143;
  color: #555;
  background-color: #fff;
  background-image: none;
}

.table2 {
  width: 100%;
  max-width: 100%;
  margin-bottom: 20px;
  display:table}

  .table2>tbody>tr>td, .table2>tbody>tr>th, .table2>tfoot>tr>td, .table2>tfoot>tr>th, .table2>thead>tr>td, .table2>thead>tr>th {
    border-color: #e2e7eb;
    padding: 10px 15px;
  }
  </style>


  <form method="post" data-parsley-validate="true" name="form-wizard" enctype="multipart/form-data"> {% csrf_token %}
   {{ guiaremision_form.title.errors }}
   <!-- begin row -->
   <div class="row">
    <!-- begin col-6 -->
    <div class="col-md-12">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title">Guia de Remision</h3>
        </div>
        <div class="panel-body">
          <div class="col-md-12">
            <div>

              <!-- Nav tabs -->
              <ul class="nav nav-tabs" role="tablist">
                <li role="presentation" class="active"><a href="#principales" aria-controls="principales" role="tab" data-toggle="tab">Documento</a></li>

              </ul>

              <!-- Tab panes -->
              <div class="tab-content">
                <div role="tabpanel" class="tab-pane fade in active" id="principales">
                  <!--INICIO ORDEN PRODUCCION-->

                  <div class="row">
                    <div class="col-md-12">
                      <div class="panel panel-default panel-border">
                        <div class="panel-heading">Documento</div>
                        <div class="panel-body">

                          <div class="col-md-4">
                            <label for="id_nro_guia">Numero</label>
                            {% bootstrap_field guiaremision_form.nro_guia show_label=False %}

                          </div>
                            
                          <div class="col-md-4">
                            <label for="id_fecha_inicio">Fecha Inicio Traslado</label>
                            {% bootstrap_field guiaremision_form.fecha_inicio show_label=False%}
                          </div>
                          <div class="col-md-4">
                            <label for="id_fecha_fin">Fecha Fin Traslado</label>
                            {% bootstrap_field guiaremision_form.fecha_fin show_label=False%}
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-12">
                      <div class="panel panel-default panel-border">
                        <div class="panel-heading">Datos Comprobante</div>
                        <div class="panel-body">

                          <div class="col-md-3">
                            <label for="id_tipo_documento">Tipo Documento</label>
                            {% bootstrap_field guiaremision_form.tipo_documento show_label=False %}
                            <!-- <div class="col-md-3"> -->
                              <br
                              <label for="id_no_pedido">No. Pedido</label>
                              <input type="text" id="id_no_pedido" name="no_pedido" class="form-control">
                            <!-- </div> -->
                            
                          </div>
                          <div class="col-md-3">
                            <label for="id_fecha_emision">Fecha Emision</label>
                            {% bootstrap_field guiaremision_form.fecha_emision show_label=False%}
                          </div>
                        
                         <!--  <div class="col-md-3">
                            <label for="id_nro_comprobante">Numero Comprobante</label>
                            {% bootstrap_field guiaremision_form.nro_comprobante show_label=False %}
                          </div>-->
                         <div class="col-md-6">
                            <label for="id_motivo_traslado">Motivo Traslado</label>
                            {% bootstrap_field guiaremision_form.tipo_guia show_label=False%}
                          </div>
                            <div class="col-md-3" id='ingreso' style="display:none">
                            <label for="id_nro_comprobante">Ingreso</label>
                            {% bootstrap_field guiaremision_form.ingreso show_label=False %}
                          </div>
                          <div class="col-md-3" id='egreso' style="display:none">
                            <label for="id_nro_comprobante">Egreso</label>
                            {% bootstrap_field guiaremision_form.egreso show_label=False %}
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-12">
                      <div class="panel panel-default panel-border">
                        <div class="panel-heading">Datos Principales</div>
                        <div class="panel-body">

                          <div class="form-horizontal form-ajust">
                               <div class="form-group">
                           <label for="id_vehiculo" class="col-sm-3 control-label">Puntos de Venta</label>
                           <div class="col-sm-6">
                             <select class="form-control" name="punto_venta_descripcion" required>
                                            <option value="">SELECCIONE PUNTO DE VENTA</option>
                                            {% for punto in puntos_venta %}
                                            <option value="{{ punto.id }}"
                                                    data-punto-emision="{{ punto.punto_emision }}"
                                                    data-establecimiento="{{ punto.establecimiento }}"
                                                    data-secuencial="{{ punto.secuencial_guia_electronica }}"
                                                    data-autorizacion="{{ punto.autorizacion }}">
                                                {{ punto.codigo }} - {{ punto.nombre }}
                                            </option>
                                            {% endfor %}
                                        </select>
                           </div>

                         </div>
                               <div class="form-horizontal form-ajust">
                               <div class="form-group">
                           <label for="id_bodega" class="col-sm-3 control-label">Bodega</label>
                           <div class="col-sm-6">
                             {% bootstrap_field guiaremision_form.bodega show_label=False %}
                           </div>

                         </div>
                            <div class="form-group">
                             <label for="id_cliente" class="col-sm-3 control-label">Cliente</label>

                             <div class="col-sm-6">
                              {% bootstrap_field guiaremision_form.cliente show_label=False %}

                            </div>

                          </div>

                          <div class="form-group">
                           <label for="id_vehiculo" class="col-sm-3 control-label">Vehiculo</label>
                           <div class="col-sm-6">
                             {% bootstrap_field guiaremision_form.vehiculo show_label=False %}
                           </div>

                         </div>
                         <div class="form-group">
                           <label for="id_chofer" class="col-sm-3 control-label">Chofer</label>
                           <div class="col-sm-6">
                            {% bootstrap_field guiaremision_form.chofer show_label=False %}
                          </div>

                        </div>
                        <div class="form-group">
                         <label for="id_partida" class="col-sm-3 control-label">Partida</label>
                         <div class="col-sm-6">
                          {% bootstrap_field guiaremision_form.partida show_label=False %}

                        </div>
                      </div>
                      <div class="form-group">
                       <label for="id_destino" class="col-sm-3 control-label">Destino</label>
                       <div class="col-sm-6">
                        {% bootstrap_field guiaremision_form.destino show_label=False %}

                      </div>

          </div>
                                <button type="button" class="btn btn-primary" data-toggle="modal" onclick="op_ad()">Productos</button>


                    </div>

                  </div>

                </div>
              </div>
            </div>

       </div>
        <div class="row">
            <div class="col-md-12">
              <div class="panel panel-default panel-border">
                <!-- Default panel contents -->
                <div class="panel-heading">Productos</div>
                <div class="panel-body">



                <!-- Table -->
                <table class="table2 table-striped table-bordered" id="tabla" >
                  <tr>
                    <th></th>
                    <th style="width:150px" >Item</th>
                    <th>Nombre</th>
                    <th style="width:120px">Cant.</th>

                  </tr>

               </table>
             </div> </div>
           </div>


         </div>

     </div>



     <!--FIN ORDEN PRODUCCION-->
   </div>


 </div>

</div>
</div>
                   <!--      <div class="col-md-2">
                            <div class="row">
                             
                    <p class="text-center">
                    <button type="button" class="btn btn-success btn-block">Agregar <i class=" glyphicon glyphicon-plus icon-white"></i></button>
                    </p>
                    <p class="text-center">
                    <button type="button" class="btn btn-danger btn-block">Eliminar <i class=" glyphicon glyphicon-trash icon-white"></i></button>
                    </p>
                    <p class="text-center">
                    <button type="button" class="btn btn-default btn-block">Buscar <i class=" glyphicon glyphicon-search icon-white"></i></button>
                    </p>
                    <p class="text-center">
                    <button type="button" class="btn btn-default btn-block">Imprimir <i class=" glyphicon glyphicon-print icon-white"></i></button>
                    </p>
                              
                            </div>
                            
                          </div> -->
                        </div>
                      </div>
                    </div>
                  </div>

                  <p class="text-center">

                    <button type="submit" class="btn btn-primary btn-lg"><i class="fa fa-cog"></i> Guardar</button>
                    <a class="default btn btn-link" href="/facturacion/guiaremision/"><button type="button" class="btn btn-primary btn-lg">  Regresar</button></a>
                  </p>
<!--  <p class="text-right m-b-0">
                                    <button type="submit" class="btn btn-primary"><i class="fa fa-cog"></i> Guardar</button>
                                </p>
                                <a class="default btn btn-link" href="/inventario/producto">
      <i class="fa fa-times"></i> Regresar
    </a> -->
    <input type="hidden" name="columnas_receta" id="columnas_receta" value="1" />

    <input type="hidden" name="id_fila_cambiar" id="id_fila_cambiar" value="" />
                                <input type="hidden" name="total" id="total" value="0" />


  </form>
     <div class="modal fade bs-example-modal-sm" id="modal-dialog">
                        <div class="modal-dialog">
                            <div class="modal-content">
                             <div class="panel-body">
                                <div class="table-responsive">
                                                    <table class="table table-striped table-bordered" id="tabla">
                                                        <thead>
                                                            <tr>
                                                            <td></td>
                                                                <th>Codigo</th>
                                                                <th>Nombre</th>
                                                                
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                        {% for producto  in productos %}
                                                            <tr>
                                                                <td  onclick="cargarCodigoProducto('{{ producto.producto_id }}','{{ producto.codigo_producto }}','{{ producto.descripcion_producto }}','{{ producto.medida }}','{{ producto.costo }}')"><a class="btn btn-danger remove_fields" >
                                                        <i class=" glyphicon glyphicon-plus icon-white"></i>
                                                      </a></td><td>{{ producto.codigo_producto }}</td>
                                                                <td>{{ producto.descripcion_producto }}</td>
                                                            </tr >
                                                        {% endfor %} 
                                                        
                                                        </tbody>
                                                    </table>
                                                </div>
                                                <button type="button" onclick="cerrar()" class="btn btn-danger btn-block">Cerrar <i class=" glyphicon glyphicon-trash icon-white"></i></button>
                                            

                            </div>
                        </div>
                    </div>
                    </div>
                      <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
    <div class="panel-body">
                                <div class="table-responsive">
                                                    <table class="table table-striped table-bordered" id="tabla2">
                                                        <thead>
                                                            <tr>
                                                            <td></td>
                                                                <th>Codigo</th>
                                                                <th>Nombre</th>
                                                                <th>Cliente</th>
                                                                <th>Descripcion</th>
                                                                <th>Vendedor</th>

                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                        {% for p  in proformas %}
                                                            <tr>
                                                                <td  onclick="cargarCodigoProforma('{{ p.codigo }}')"><a class="btn btn-danger remove_fields"  href="{% url 'crear-guiaremision-proforma' p.id %}">
                                                        <i class=" glyphicon glyphicon-plus icon-white"></i>
                                                      </a></td><td>{{ p.abreviatura_codigo }}-{{ p.codigo }}</td>
                                                                <td>{{ p.fecha }}</td>
                                                                <td>{{ p.cliente.nombre_cliente }}</td>
                                                                 <td>{{ p.descripcion }}</td>
                                                                 <td>{{ p.vendedor.nombre }}</td>


                                                            </tr >
                                                        {% endfor %} 
                                                        
                                                        </tbody>
                                                    </table>
                                                </div>
                                                <button type="button" onclick="cerrarProforma()" class="btn btn-danger btn-block">Cerrar <i class=" glyphicon glyphicon-trash icon-white"></i></button>
                                            
</div>
  </div>
                           </div>
  </div>
</div>
 <div aria-hidden="true" style="display: none;"  id="dlgOP" class="modal fade">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header text-center">
                    <button type="button" class="close" data-dismiss="modal">×</button>
                    <h4 id="id_popup_OP" class="modal-title"></h4>
                </div>
                <div class="modal-body">
                   <input type="hidden" id="tipo_egreso_id" name="tipo_egreso" value="" />
                   <div id="contenido_dlgOP">
                       <div class="indicator show"><span class="spinner spinner16"></span></div>
                   </div>
                </div>
            </div>
        </div>
    </div>

  {% endblock %}

  {% block javascript %}
  {{ block.super }}
  <!-- ================== BEGIN PAGE LEVEL JS ================== -->
  <script src="{% static 'color_admin/assets/plugins/parsley/dist/parsley.js' %}"></script>
  <script src="{% static 'color_admin/assets/plugins/bootstrap-wizard/js/bwizard.js' %}"></script>
  <script src="{% static 'color_admin/assets/js/form-wizards-validation.demo.min.js' %}"></script>
  <script src="{% static 'color_admin/assets/js/apps.min.js' %}"></script>
  <script src="{% static 'color_admin/assets/plugins/DataTables-1.9.4/js/jquery.dataTables.js' %}"></script>
  <script src="{% static 'color_admin/assets/plugins/DataTables-1.9.4/js/data-table.js' %}"></script> 

  <script src="{% static 'color_admin/assets/plugins/parsley/dist/parsley.js' %}"></script>
  <script src="{% static 'color_admin/assets/plugins/bootstrap-wizard/js/bwizard.js' %}"></script>
  <script src="{% static 'color_admin/assets/js/form-wizards-validation.demo.min.js' %}"></script>
  <script src="{% static 'color_admin/assets/js/apps.min.js' %}"></script>
  <script src="{% static 'color_admin/assets/js/bootstrap-datepicker.js' %}"></script>

  <script>
  $(document).ready(function() {

    $('.table').DataTable();
    FormWizardValidation.init();
    
    
        $(function () {
        $('select[name="punto_venta_descripcion"]').change(function () {
            var selected = $(this).find('option:selected');
            $('input[name="punto_venta"]').val(selected.val());
            var punto_emision = ''+selected.data('punto-emision');
            var establecimiento = ''+selected.data('establecimiento');
            var secuencial = selected.data('secuencial');
            $('#id_nro_guia').val(secuencial);

           
        });
    });
        
        
$.ajax({
                url: "/config/obtenerSecuencial/", // the endpoint
                type : "POST", // http method
                data : { id : 'guiaremision','csrfmiddlewaretoken': '{{ csrf_token }}'},
                success:function(data){
                 $('#id_nro_guia').val(data);

               },
               error: function(xhr, ajaxOptions, thrownError){
                alert( "Escoja una empresa");
              },
            });

        $('input[type=radio][name=tipo_guia]').change(function() {
                var tipo=$('input:radio[name=tipo_guia]:checked').val();
                 $.ajax({
                url: "/facturacion/obtenerTipo/", // the endpoint
                type : "POST", // http method
                data : { id : tipo,'csrfmiddlewaretoken': '{{ csrf_token }}'}, 
                success:function(data){
                  if(data=='ingreso'){
                    jQuery('#ingreso').css("display","block");
                   jQuery('#egreso').css("display","none");
                    $("#id_ingreso").prop('checked', true);
                    $("#id_egreso").prop('checked', false);
                     $('#ingreso').prop('disabled', true);
                   $('#egreso').prop('disabled', true);
                
                  }
                 if(data=='egreso'){
                    jQuery('#egreso').css("display","block");
                     jQuery('#ingreso').css("display","none");
                    $("#id_egreso").prop('checked', true);
                    $("#id_ingreso").prop('checked', false);
                      $('#ingreso').prop('disabled', true);
                   $('#egreso').prop('disabled', true);
                
                  }
                   if(data==''){

                    jQuery('#egreso').css("display","block");
                     jQuery('#ingreso').css("display","block");
                     $("#id_ingreso").prop('checked', false);
                     $("#id_egreso").prop('checked', false);

                    alert('Escoja si es un ingreso o egreso');
                  }


               },
                 error: function(xhr, ajaxOptions, thrownError){
                  alert( "Escoja si es un ingreso o egreso");
                },
                });


        });

  });
  </script>
  <script>
   $(document).ready(function() {
    //$('#id_bodega').attr('readonly','readonly');
    //$('#id_bodega option[value=1]').attr('selected','selected');
    $('#id_nro_guia').each(function(){
      $(this).attr('readonly','readonly');
    });
       $('#id_bodega').change(function(){
        var bodega=$("#id_bodega").val();
           var cliente=$("#id_cliente").val();

           if (cliente==''){
               //alert(cliente);
               cliente=0
           }

               $.ajax({
                url: "/facturacion/cargarDireccionBodega/", // the endpoint
                type : "POST", // http method
                data : { bodega_id : bodega,'csrfmiddlewaretoken': '{{ csrf_token }}'},
                success:function(data){

                    $("#id_partida").val(data['direccion_partida']);


                },
                error: function(){

                },
              });
         });


          $('#id_cliente').change(function(){
           var cliente=$("#id_cliente").val();



               $.ajax({
                url: "/facturacion/cargarDireccionCliente/", // the endpoint
                type : "POST", // http method
                data : { cliente_id : cliente,'csrfmiddlewaretoken': '{{ csrf_token }}'},
                success:function(data){

                    $("#id_destino").val(data['direccion_destino']);


                },
                error: function(){

                },
              });
         });
$('#id_fecha_emision').datepicker({todayHighlight:true,autoclose:true,format:'yyyy-mm-dd'});
$('#id_fecha_inicio').datepicker({todayHighlight:true,autoclose:true,format:'yyyy-mm-dd'});
$('#id_fecha_fin').datepicker({todayHighlight:true,autoclose:true,format:'yyyy-mm-dd'});

      // $.ajax({
    //             url: "/config/obtenerSecuencial/", // the endpoint
    //             type : "POST", // http method
    //             data : { id : 'guiaremision','csrfmiddlewaretoken': '{{ csrf_token }}'}, 
    //             success:function(data){
    //              $('#id_nro_guia').val(data);

    //            },
    //            error: function(xhr, ajaxOptions, thrownError){
    //             alert( "Escoja una empresa");
    //           },
    //         });
  });

  </script>
  <script>
  $(document).ready(function() {
    $('#id_codigo_producto').each(function(){
      $(this).attr('readonly','readonly');
    });
    $('#id_created_by').each(function(){
      $(this).attr('readonly','readonly');
    });
    $('#id_updated_by').each(function(){
      $(this).attr('readonly','readonly');
    });
    $('#id_created_at').each(function(){
      $(this).attr('readonly','readonly');
    });
    $('#id_updated_at').each(function(){
      $(this).attr('readonly','readonly');
    });
    var codigo_producto=$('#id_codigo_producto').val();
      //alert(codigo_producto);
      if(codigo_producto==""){
       $.ajax({
                url: "/config/obtenerSecuencial/", // the endpoint
                type : "POST", // http method
                data : { id : 'producto','csrfmiddlewaretoken': '{{ csrf_token }}'}, 
                success:function(data){
                 $('#id_codigo_producto').val(data);

               },
               error: function(){

               },
             });
     }


   });
function mostrarProductos(data){
 $('#id_fila_cambiar').val(data);
 $(".bs-example-modal-sm").modal('toggle');
}
function cerrar(){
 $(".bs-example-modal-sm").modal('toggle');
}
function cerrarProforma(){
 $(".bs-example-modal-lg").modal('toggle');
}

function cargarCodigoProducto(id,codigo,descripcion,medida,costo){
  var fila=$('#id_fila_cambiar').val();
  $('#id_kits'+fila).val(id);
  $('#codigo_kits'+fila).val(codigo);
  $('#nombre_kits'+fila).html("");
  $('#nombre_kits'+fila).append(descripcion);
  $('#medida_kits'+fila).val(medida);
  $('#cantidad_kits'+fila).val('')
  cerrar();

}
    </script>
    <script type="text/javascript">
    $(document).ready(function(){
        /**
         * Funcion para añadir una nueva columna en la tabla
         */
         $("#add").click(function(){
            // Obtenemos el numero de filas (td) que tiene la primera columna
            // (tr) del id "tabla"
            var num_recetas=$('#columnas_receta').val();
            num_recetas=parseInt(num_recetas)+1;

            var tds=$("#tabla tr:first td").length;
            // Obtenemos el total de columnas (tr) del id "tabla"
            var trs=$("#tabla tr").length;
            var nuevaFila='<tr><td  class="eliminar"><a class="btn btn-danger remove_fields "><i class=" glyphicon glyphicon-trash icon-white"></i></a></td>';
            nuevaFila+='<td><input type="hidden" class="form-control" id="id_kits'+num_recetas+'" name="id_kits'+num_recetas+'"> ';
            nuevaFila+='<input type="text" required="required" class="form-control" id="codigo_kits'+num_recetas+'" name="codigo_kits'+num_recetas+'" onfocus="mostrarProductos('+num_recetas+')" readonly="readonly"></td>';
            nuevaFila+='<td><span  id="nombre_kits'+num_recetas+'" name="nombre_kits'+num_recetas+'" ></span></td>';
            nuevaFila+='<td><input type="text" class="form-control" required="required" id="cantidad_kits'+num_recetas+'" name="cantidad_kits'+num_recetas+'"></td>';
            nuevaFila+='<td><input type="text" class="form-control" id="medida_kits'+num_recetas+'" name="medida_kits'+num_recetas+'" readonly="readonly"></td>';
            nuevaFila+='</tr>';
            $('#columnas_receta').val(num_recetas);
            // for(var i=0;i<tds;i++){
            //     // añadimos las columnas
            //     nuevaFila+="<td>columna "+(i+1)+" Añadida con jquery</td>";
            // }
            // // Añadimos una columna con el numero total de columnas.
            // // Añadimos uno al total, ya que cuando cargamos los valores para la
            // // columna, todavia no esta añadida
            // nuevaFila+="<td>"+(trs+1)+" columnas";
            // nuevaFila+="</tr>";
            $("#tabla").append(nuevaFila);
          });

        /**
         * Funcion para eliminar la ultima columna de la tabla.
         * Si unicamente queda una columna, esta no sera eliminada
         */
         $("#del").click(function(){
            // Obtenemos el total de columnas (tr) del id "tabla"
            var trs=$("#tabla tr").length;
            if(trs>1)
            {
                // Eliminamos la ultima columna
                $("#tabla tr:last").remove();
              }
            });


         $(document).on("click",".eliminar",function(){
          var parent = $(this).parent();
          $(parent).remove();
        });

       });
         function op_ad(){
            $("#id_popup_OP").html("<b>Productos</b>");
            var id_cliente=$("#id_cliente").val();
             var tipo_guia=$('input:radio[name=tipo_guia]:checked').val();
             var bodega=$("#id_bodega").val();
             var mensaje='Debe ingresar: ';
             var cont=0;
            // alert(tipo_guia);


             if (id_cliente==''){
                 mensaje+=' cliente,';
                 cont++;

             }
             if (tipo_guia=='' || tipo_guia=='undefined'){
                 mensaje+=' tipo de guia,';
                 cont++;

             }
             if (bodega==''){
                 mensaje+=' bodega,';
                 cont++;

             }
             if (cont >0 ){
                 alert(mensaje);
             }else {


                 var parametros = {
                     'id_cliente': id_cliente,
                     'id_bodega': bodega,
                     'id_tipo_guia': tipo_guia,

                     'csrfmiddlewaretoken': '{{ csrf_token }}'

                 }

                 $.ajax({
                     url: "/facturacion/mostrar_op/",
                     type: "POST",
                     async: true,
                     data: parametros,
                     success: function (data) {
                         $('#contenido_dlgOP').html(data);


                     },
                     complete: function () {
                         $("#btn_guardar_egresos").show();
                     }
                 });
                 $('#dlgOP').modal();
             }
        }
  function actualizarCosto(data){
      var cantidad=$('#cantidad_kits'+data).val();
      var costo= $('#valor_kits'+data).val();

       var valor=parseFloat(parseFloat(cantidad)*parseFloat(costo)).toFixed(2);

      //  alert(data);
      // alert(costo);
      // alert(valor);
      $('#total_kits'+data).val(valor);
      actualizarTotal();
    }
    function actualizarTotal(){
      var num_recetas=$('#columnas_receta').val();
      var total=0;
      var cantidad=0;
      var descuento=0;
      var porcentaje_descuento=0;
      var totalidad=0;
      var costo=0;
      var subt=0;
      var i;
      
 //alert(' BNUM RECETS'+num_recetas);
      for (i = 1; i <= num_recetas; i++) {
        //alert(i);
        costo= $('#valor_kits'+i).val();
        //alert(costo);
        if (typeof costo === "undefined" ){
         // alert('entr');
          costo=0;
        }else{
          costo = costo.toString().replace(/\,/g,'.'); 
        }
        
        //alert(costo);
        $('#valor_kits'+i).val(costo);
        subt = $('#cantidad_kits'+i).val();
          if (typeof subt === "undefined" ){
            subt=0;
          }else{
            subt = subt.toString().replace(/\,/g,'.'); 
          }
          
        
        $('#cantidad_kits'+i).val(subt);
       var total_kits=subt*costo;
          $('#total_kits'+i).val(total_kits);
            total=parseFloat(total)+parseFloat(total_kits);
          
        
         
      }
       
       //total=(total).toFixed(2);
       //alert(total);
      $('#total').val((total).toFixed(2));
     


    }
    

</script>
{% endblock %}                                                                                                                                                                                                                                                                